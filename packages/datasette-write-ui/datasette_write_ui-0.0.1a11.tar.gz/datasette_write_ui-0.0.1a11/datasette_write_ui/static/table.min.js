function re(e){let n=document.createElement("template");return n.innerHTML=e,document.importNode(n.content,!0)}function oe(e){let n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.innerHTML=e,n}var h=Object.assign(W(re,e=>{if(e.firstChild===null)return null;if(e.firstChild===e.lastChild)return e.removeChild(e.firstChild);let n=document.createElement("span");return n.appendChild(e),n}),{fragment:W(re,e=>e)}),st=Object.assign(W(oe,e=>e.firstChild===null?null:e.firstChild===e.lastChild?e.removeChild(e.firstChild):e),{fragment:W(oe,e=>{let n=document.createDocumentFragment();for(;e.firstChild;)n.appendChild(e.firstChild);return n})}),Be=9,He=10,Ie=12,Fe=13,Pe=32,Ge=65,qe=90,je=97,Xe=122,I=60,T=62,g=47,y=45,Q=33,V=61,ae=34,le=39,We=63,E=1,ce=2,ue=3,Y=4,F=5,k=6,J=7,P=8,G=9,Z=10,K=11,q=12,z=13,x=14,de=15,fe=16,S=17,pe=18,Ee=19,Te=20,he=21,ee=22,U=23,me=24,ye=25,_=26,_e=27,be=28,Se=29,Qe=128,we=1,Ve=8,Ye=1,Ce="http://www.w3.org/2000/svg",v="http://www.w3.org/1999/xlink",Ae="http://www.w3.org/XML/1998/namespace",ge="http://www.w3.org/2000/xmlns/",ve=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),X=new Map([["xlink:actuate",v],["xlink:arcrole",v],["xlink:href",v],["xlink:role",v],["xlink:show",v],["xlink:title",v],["xlink:type",v],["xml:lang",Ae],["xml:space",Ae],["xmlns",ge],["xmlns:xlink",ge]]);function W(e,n){return function({raw:r}){let t=E,l="",p,c,f,d,m=0;for(let o=0,b=arguments.length;o<b;++o){let a=r[o];if(o>0){let i=arguments[o];switch(t){case _:{if(i!=null){let u=`${i}`;if(Re(c))l+=u.replace(/[<]/g,D);else{if(new RegExp(`</${c}[\\s>/]`,"i").test(l.slice(-c.length-2)+u))throw new Error("unsafe raw text");l+=u}}break}case E:{i==null||(i instanceof Node||typeof i!="string"&&i[Symbol.iterator]||/(?:^|>)$/.test(r[o-1])&&/^(?:<|$)/.test(a)?(l+="<!--::"+o+"-->",m|=Qe):l+=`${i}`.replace(/[<&]/g,D));break}case G:{t=q;let u;if(/^[\s>]/.test(a)){if(i==null||i===!1){l=l.slice(0,f-r[o-1].length);break}if(i===!0||(u=`${i}`)==""){l+="''";break}if(r[o-1].slice(f,d)==="style"&&te(i)||typeof i=="function"){l+="::"+o,m|=we;break}}if(u===void 0&&(u=`${i}`),u==="")throw new Error("unsafe unquoted empty string");l+=u.replace(/^['"]|[\s>&]/g,D);break}case q:{l+=`${i}`.replace(/[\s>&]/g,D);break}case K:{l+=`${i}`.replace(/['&]/g,D);break}case Z:{l+=`${i}`.replace(/["&]/g,D);break}case k:{if(te(i)){l+="::"+o+"=''",m|=we;break}throw new Error("invalid binding")}case S:break;default:throw new Error("invalid binding")}}for(let i=0,u=a.length;i<u;++i){let s=a.charCodeAt(i);switch(t){case E:{s===I&&(t=ce);break}case ce:{s===Q?t=ye:s===g?t=ue:j(s)?(p=i,c=void 0,t=Y,--i):s===We?(t=F,--i):(t=E,--i);break}case ue:{j(s)?(t=Y,--i):s===T?t=E:(t=F,--i);break}case Y:{N(s)?(t=k,c=H(a,p,i)):s===g?t=x:s===T&&(c=H(a,p,i),t=B(c)?_:E);break}case k:{N(s)||(s===g||s===T?(t=J,--i):s===V?(t=P,f=i+1,d=void 0):(t=P,--i,f=i+1,d=void 0));break}case P:{N(s)||s===g||s===T?(t=J,--i,d=i):s===V&&(t=G,d=i);break}case J:{N(s)||(s===g?t=x:s===V?t=G:s===T?t=B(c)?_:E:(t=P,--i,f=i+1,d=void 0));break}case G:{N(s)||(s===ae?t=Z:s===le?t=K:s===T?t=B(c)?_:E:(t=q,--i));break}case Z:{s===ae&&(t=z);break}case K:{s===le&&(t=z);break}case q:{N(s)?t=k:s===T&&(t=B(c)?_:E);break}case z:{N(s)?t=k:s===g?t=x:s===T?t=B(c)?_:E:(t=k,--i);break}case x:{s===T?t=E:(t=k,--i);break}case F:{s===T&&(t=E);break}case de:{s===y?t=fe:s===T?t=E:(t=S,--i);break}case fe:{s===y?t=U:s===T?t=E:(t=S,--i);break}case S:{s===I?t=pe:s===y&&(t=ee);break}case pe:{s===Q?t=Ee:s!==I&&(t=S,--i);break}case Ee:{s===y?t=Te:(t=S,--i);break}case Te:{s===y?t=he:(t=U,--i);break}case he:{t=U,--i;break}case ee:{s===y?t=U:(t=S,--i);break}case U:{s===T?t=E:s===Q?t=me:s!==y&&(t=S,--i);break}case me:{s===y?t=ee:s===T?t=E:(t=S,--i);break}case ye:{s===y&&a.charCodeAt(i+1)===y?(t=de,++i):(t=F,--i);break}case _:{s===I&&(t=_e);break}case _e:{s===g?t=be:(t=_,--i);break}case be:{j(s)?(p=i,t=Se,--i):(t=_,--i);break}case Se:{N(s)&&c===H(a,p,i)?t=k:s===g&&c===H(a,p,i)?t=x:s===T&&c===H(a,p,i)?t=E:j(s)||(t=_,--i);break}default:{t=void 0;break}}}l+=a}let w=e(l),L=document.createTreeWalker(w,m,null,!1),C=[];for(;L.nextNode();){let o=L.currentNode;switch(o.nodeType){case Ye:{let b=o.attributes;for(let a=0,i=b.length;a<i;++a){let{name:u,value:s}=b[a];if(/^::/.test(u)){let O=arguments[+u.slice(2)];ke(o,u),--a,--i;for(let $ in O){let A=O[$];A==null||A===!1||(typeof A=="function"?o[$]=A:$==="style"&&te(A)?Ne(o[$],A):Je(o,$,A===!0?"":A))}}else if(/^::/.test(s)){let O=arguments[+s.slice(2)];ke(o,u),--a,--i,typeof O=="function"?o[u]=O:Ne(o[u],O)}}break}case Ve:{if(/^::/.test(o.data)){let b=o.parentNode,a=arguments[+o.data.slice(2)];if(a instanceof Node)b.insertBefore(a,o);else if(typeof a!="string"&&a[Symbol.iterator])if(a instanceof NodeList||a instanceof HTMLCollection)for(let i=a.length-1,u=o;i>=0;--i)u=b.insertBefore(a[i],u);else for(let i of a)i!=null&&b.insertBefore(i instanceof Node?i:document.createTextNode(i),o);else b.insertBefore(document.createTextNode(a),o);C.push(o)}break}}}for(let o of C)o.parentNode.removeChild(o);return n(w)}}function D(e){return`&#${e.charCodeAt(0).toString()};`}function j(e){return Ge<=e&&e<=qe||je<=e&&e<=Xe}function N(e){return e===Be||e===He||e===Ie||e===Pe||e===Fe}function te(e){return e&&e.toString===Object.prototype.toString}function B(e){return e==="script"||e==="style"||Re(e)}function Re(e){return e==="textarea"||e==="title"}function H(e,n,r){return e.slice(n,r).toLowerCase()}function Je(e,n,r){if(e.namespaceURI===Ce&&(n=n.toLowerCase(),n=ve.get(n)||n,X.has(n))){e.setAttributeNS(X.get(n),n,r);return}e.setAttribute(n,r)}function ke(e,n){if(e.namespaceURI===Ce&&(n=n.toLowerCase(),n=ve.get(n)||n,X.has(n))){e.removeAttributeNS(X.get(n),n);return}e.removeAttribute(n)}function Ne(e,n){for(let r in n){let t=n[r];r.startsWith("--")?e.setProperty(r,t):e[r]=t}}var Ze=document.querySelector("script#datasette-write-ui-config"),Le=JSON.parse(Ze.textContent),M=Le,R=Le.base_url;async function ne(e){let n=await e.json();if(e.status<200||e.status>299||!n.ok)throw Error(n.errors?n.errors.join(", "):"Unknown error");return n}async function Oe(e,n,r){return fetch(`${R}${e}/${n}/${r}/-/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then(ne)}async function De(e,n,r,t){return fetch(`${R}${e}/${n}/${r}/-/update`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(ne)}async function Me(e,n,r){return fetch(`${R}${e}/${n}/-/insert`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({row:r})}).then(ne)}async function $e(e,n,r){return fetch(`${R}-/datasette-write-ui/edit-row-details?${new URLSearchParams({db:e,table:n,primaryKeys:r})}`).then(t=>t.json())}async function xe(e,n){return fetch(`${R}-/datasette-write-ui/insert-row-details?${new URLSearchParams({db:e,table:n})}`).then(r=>r.json())}var ie=class{constructor(){this.root=h`<div class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="modal-title"></h2>
        <div class="modal-body"></div>
      </div>
    </div>`,document.body.appendChild(this.root),this.body=this.root.querySelector(".modal-body"),this.title=this.root.querySelector(".modal-title"),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.setTitle=this.setTitle.bind(this),this.setBody=this.setBody.bind(this),this.root.querySelector(".close").addEventListener("click",this.hide),document.addEventListener("keydown",n=>{n.key==="Escape"&&this.hide()})}hide(){return this.root.style.display="none",this}show(){return this.root.style.display="block",this}setTitle(n){return this.title.innerText=n,this}setBody(n){return this.body.innerHTML="",this.body.appendChild(n),this}},se=class{constructor(n){this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.toggle=this.toggle.bind(this),this.addButton=this.addButton.bind(this),this.root=h`<span class="row-icon"><button class="icon">&#9881;</button><div class="datasette-write-ui-menu"></div></span>`,n.insertBefore(this.root,n.querySelector("a")),this.icon=this.root.querySelector(".icon"),this.menu=this.root.querySelector(".datasette-write-ui-menu"),this.icon.addEventListener("click",r=>{r.stopPropagation(),this.toggle()}),document.addEventListener("click",this.hide),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.hide()}),this.menu.addEventListener("click",r=>{r.stopPropagation()})}hide(){this.menu.style.display="none",this.menu.isShown=!1}show(){Array.from(document.querySelectorAll(".datasette-write-ui-menu")).forEach(r=>{r.style.display="none",r.isShown=!1});let n=document.body;this.menu.style.display="block",this.menu.isShown=!0,Ke(this.menu,n)}toggle(){this.menu.isShown?this.hide():this.show()}addButton(n,r){return this.menu.appendChild(h`<button onClick=${r}>${n}</button>`),this}};function Ke(e,n){let r=e.getBoundingClientRect(),t=n.getBoundingClientRect(),l=r.top-t.top,p=r.left-t.left;e.style.position="absolute",e.style.top=l+"px",e.style.left=p+"px",n.appendChild(e)}function ze(e){return e.type==="int"||e.type==="float"||e.type==="INT"?h`<input
      type="number"
      value=${e.value}
      name=${e.key}
      id=${e.key}
      disabled=${!e.editable}
      step=${e.type==="int"?1:.01}
    />`:e.type==="str"||e.type=="TEXT"?h`<textarea
        name=${e.key}
        id=${e.key}
        disabled=${!e.editable}>${e.value}`:h`<p>Unsupported type ${e.type} for ${e.key}</p>`}function et(e){return e.affinity==="int"||e.affinity==="real"||e.affinity==="numeric"?h`<input
      type="number"
      name=${e.name}
      id=${e.name}
      step=${e.affinity==="int"?1:.01}
    />`:e.affinity=="text"?h`<textarea
        name=${e.name}
        id=${e.name}>`:h`<p>Unsupported type ${e.affinity} for ${e.name}</p>`}function tt(e,n,r){return async function(){let l=await $e(e,n,r),p=new Map;function c(d){d.preventDefault();let m={};for(let[L,C]of p.entries()){if(C.disabled)continue;let o=C.type==="number"?C.valueAsNumber:C.value;m[L]=o}De(e,n,r,{update:m,return:!0}).then(()=>window.location.reload())}let f=h` <form onSubmit=${c}>
      <div>
        <div class="form-fields-container">
          ${l.fields.map(d=>{let m=ze(d);return p.set(d.key,m),h.fragment`
                <div> <label for=${d.key}>${d.key}</label> ${d.pk?"\u{1F511}":""} </div>
                <div> ${m} </div>
                `})}
        </div>
      </div>
      <input type="submit" value="Submit" />
    </form>`;Ue.setBody(f).setTitle(`Editing ${e}/${n}/${r}`).show()}}function nt(e,n){return async function(){let{fields:t}=await xe(e,n),l=new Map;function p(f){f.preventDefault();let d={};for(let[m,w]of l.entries()){if(w.disabled)continue;let L=w.type==="number"?w.valueAsNumber:w.value;d[m]=L}Me(e,n,d).then(()=>window.location.reload())}let c=h` <form onSubmit=${p}>
      <div>
        <div class="form-fields-container">
          ${t.map(f=>{let d=et(f);return l.set(f.name,d),h.fragment`
                <div> <label for=${f.name}>${f.name}</label></div>
                <div> ${d} </div>
                `})}
        </div>
      </div>
      <input type="submit" value="Submit" />
    </form>`;Ue.setBody(c).setTitle(`Inserting into ${e}/${n}`).show()}}function it(e,n,r){return function(){window.confirm(`Are you sure you want to delete ${e}/${n}/${r}?`)&&Oe(e,n,r).then(()=>window.location.reload())}}var Ue=new ie;if(M.can_update||M.can_delete){let e=Array.from(document.querySelectorAll("table.rows-and-columns td.type-pk"));for(let n of e){let r=n.querySelector("a").getAttribute("href"),[t,l,p]=r.split("/").slice(-3),c=new se(n);if(M.can_update){let f=tt(t,l,p);c.addButton("Edit",f)}if(M.can_delete){let f=it(t,l,p);c.addButton("Delete",f)}}}M.can_insert&&document.querySelector("#datasette-write-ui-insert-button").addEventListener("click",async()=>{let[n,r]=window.location.pathname.split("/").slice(-2);nt(n,r)()});
