"use strict";(self.webpackChunkbuckaroo=self.webpackChunkbuckaroo||[]).push([[840],{4840:(e,t,o)=>{o.r(t),o.d(t,{ClientSideRowModelModule:()=>p});var i=o(1033),r=class{constructor(e,t,o,i,r,s){this.nextId=0,this.rowCountReady=!1,this.allNodesMap={},this.rootNode=e,this.gos=t,this.eventService=o,this.funcColsService=i,this.beans=s,this.selectionService=r,this.rootNode.group=!0,this.rootNode.level=-1,this.rootNode.id="ROOT_NODE_ID",this.rootNode.allLeafChildren=[],this.rootNode.childrenAfterGroup=[],this.rootNode.childrenAfterSort=[],this.rootNode.childrenAfterAggFilter=[],this.rootNode.childrenAfterFilter=[]}getCopyOfNodesMap(){return(0,i._cloneObject)(this.allNodesMap)}getRowNode(e){return this.allNodesMap[e]}setRowData(e){if("string"==typeof e)return void(0,i._warnOnce)("rowData must be an array.");this.rowCountReady=!0,this.dispatchRowDataUpdateStartedEvent(e);const t=this.rootNode,o=this.rootNode.sibling;t.childrenAfterFilter=null,t.childrenAfterGroup=null,t.childrenAfterAggFilter=null,t.childrenAfterSort=null,t.childrenMapped=null,t.updateHasChildren(),this.nextId=0,this.allNodesMap={},e?t.allLeafChildren=e.map(((e,t)=>this.createNode(e,this.rootNode,0,t))):(t.allLeafChildren=[],t.childrenAfterGroup=[]),o&&(o.childrenAfterFilter=t.childrenAfterFilter,o.childrenAfterGroup=t.childrenAfterGroup,o.childrenAfterAggFilter=t.childrenAfterAggFilter,o.childrenAfterSort=t.childrenAfterSort,o.childrenMapped=t.childrenMapped,o.allLeafChildren=t.allLeafChildren)}updateRowData(e){this.rowCountReady=!0,this.dispatchRowDataUpdateStartedEvent(e.add);const t={rowNodeTransaction:{remove:[],update:[],add:[]},rowsInserted:!1},o=[];return this.executeRemove(e,t,o),this.executeUpdate(e,t,o),this.executeAdd(e,t),this.updateSelection(o,"rowDataChanged"),t}updateRowOrderFromRowData(e){const t=this.rootNode.allLeafChildren,o=t?.length??0,i=new Map;let r=-1,s=-1;for(let n=0;n<o;++n){const o=t[n],a=o.data;a!==e[n]&&(s<0&&(r=n),s=n,i.set(a,o))}if(r<0)return!1;for(let o=r;o<=s;++o){const r=i.get(e[o]);void 0!==r&&(t[o]=r,r.sourceRowIndex=o)}return!0}isRowCountReady(){return this.rowCountReady}dispatchRowDataUpdateStartedEvent(e){this.eventService.dispatchEvent({type:"rowDataUpdateStarted",firstRowData:e?.length?e[0]:null})}updateSelection(e,t){const o=e.length>0;o&&this.selectionService.setNodesSelected({newValue:!1,nodes:e,suppressFinishActions:!0,source:t}),this.selectionService.updateGroupsFromChildrenSelections(t),o&&this.eventService.dispatchEvent({type:"selectionChanged",source:t})}executeAdd(e,t){const o=e.add;if((0,i._missingOrEmpty)(o))return;const r=this.rootNode.allLeafChildren;let s=r.length;if("number"==typeof e.addIndex&&(s=this.sanitizeAddIndex(e.addIndex),s>0)&&this.gos.get("treeData"))for(let e=0;e<r.length;e++){const t=r[e];if(t?.rowIndex==s-1){s=e+1;break}}const n=o.map(((e,t)=>this.createNode(e,this.rootNode,0,s+t)));if(s<r.length){const e=r.slice(0,s),o=r.slice(s,r.length),i=e.length+n.length;for(let e=0,t=o.length;e<t;++e)o[e].sourceRowIndex=i+e;this.rootNode.allLeafChildren=[...e,...n,...o],t.rowsInserted=!0}else this.rootNode.allLeafChildren=r.concat(n);const a=this.rootNode.sibling;a&&(a.allLeafChildren=r),t.rowNodeTransaction.add=n}sanitizeAddIndex(e){const t=this.rootNode.allLeafChildren?.length??0;return e<0||e>=t||Number.isNaN(e)?t:Math.ceil(e)}executeRemove(e,{rowNodeTransaction:t},o){const{remove:r}=e;if((0,i._missingOrEmpty)(r))return;const s={};r.forEach((e=>{const i=this.lookupRowNode(e);i&&(i.isSelected()&&o.push(i),i.clearRowTopAndRowIndex(),s[i.id]=!0,delete this.allNodesMap[i.id],t.remove.push(i))})),this.rootNode.allLeafChildren=this.rootNode.allLeafChildren?.filter((e=>!s[e.id]))??null,this.rootNode.allLeafChildren?.forEach(((e,t)=>{e.sourceRowIndex=t}));const n=this.rootNode.sibling;n&&(n.allLeafChildren=this.rootNode.allLeafChildren)}executeUpdate(e,{rowNodeTransaction:t},o){const{update:r}=e;(0,i._missingOrEmpty)(r)||r.forEach((e=>{const i=this.lookupRowNode(e);i&&(i.updateData(e),!i.selectable&&i.isSelected()&&o.push(i),this.setMasterForRow(i,e,0,!1),t.update.push(i))}))}lookupRowNode(e){const t=(0,i._getRowIdCallback)(this.gos);let o;if(t){const r=t({data:e,level:0});if(o=this.allNodesMap[r],!o)return(0,i._errorOnce)(`could not find row id=${r}, data item was not found for this id`),null}else if(o=this.rootNode.allLeafChildren?.find((t=>t.data===e)),!o)return(0,i._errorOnce)("could not find data item as object was not found",e),(0,i._errorOnce)("Consider using getRowId to help the Grid find matching row data"),null;return o||null}createNode(e,t,o,r){const s=new i.RowNode(this.beans);return s.sourceRowIndex=r,s.group=!1,this.setMasterForRow(s,e,o,!0),t&&(s.parent=t),s.level=o,s.setDataAndId(e,this.nextId.toString()),this.allNodesMap[s.id]&&(0,i._warnOnce)(`duplicate node id '${s.id}' detected from getRowId callback, this could cause issues in your grid.`),this.allNodesMap[s.id]=s,this.nextId++,s}setMasterForRow(e,t,o,i){if(this.gos.get("treeData"))e.setMaster(!1),i&&(e.expanded=!1);else{if(this.gos.get("masterDetail")){const o=this.gos.get("isRowMaster");o?e.setMaster(o(t)):e.setMaster(!0)}else e.setMaster(!1);if(i){const t=this.funcColsService.getRowGroupColumns(),i=o+(t?t.length:0);e.expanded=!!e.master&&this.isExpanded(i)}}}isExpanded(e){const t=this.gos.get("groupDefaultExpanded");return-1===t||e<t}},s=class extends i.BeanStub{constructor(){super(...arguments),this.beanName="rowModel",this.onRowHeightChanged_debounced=(0,i._debounce)(this.onRowHeightChanged.bind(this),100),this.rowsToDisplay=[],this.hasStarted=!1,this.shouldSkipSettingDataOnStart=!1,this.isRefreshingModel=!1,this.rowCountReady=!1}wireBeans(e){this.beans=e,this.columnModel=e.columnModel,this.funcColsService=e.funcColsService,this.selectionService=e.selectionService,this.valueCache=e.valueCache,this.environment=e.environment,this.filterStage=e.filterStage,this.sortStage=e.sortStage,this.flattenStage=e.flattenStage,this.groupStage=e.groupStage,this.aggregationStage=e.aggregationStage,this.pivotStage=e.pivotStage,this.filterAggregatesStage=e.filterAggregatesStage}postConstruct(){const e=this.refreshModel.bind(this,{step:i.ClientSideRowModelSteps.EVERYTHING}),t=!this.gos.get("suppressAnimationFrame"),o=this.refreshModel.bind(this,{step:i.ClientSideRowModelSteps.EVERYTHING,afterColumnsChanged:!0,keepRenderedRows:!0,animate:t});this.addManagedEventListeners({newColumnsLoaded:o,columnRowGroupChanged:e,columnValueChanged:this.onValueChanged.bind(this),columnPivotChanged:this.refreshModel.bind(this,{step:i.ClientSideRowModelSteps.PIVOT}),filterChanged:this.onFilterChanged.bind(this),sortChanged:this.onSortChanged.bind(this),columnPivotModeChanged:e,gridStylesChanged:this.onGridStylesChanges.bind(this),gridReady:this.onGridReady.bind(this)}),this.addPropertyListeners(),this.rootNode=new i.RowNode(this.beans),this.nodeManager=new r(this.rootNode,this.gos,this.eventService,this.funcColsService,this.selectionService,this.beans)}addPropertyListeners(){const e=new Set(["treeData","masterDetail"]),t=new Set(["groupDefaultExpanded","groupAllowUnbalanced","initialGroupOrderComparator","groupHideOpenParents","groupDisplayType"]),o=new Set(["excludeChildrenWhenTreeDataFiltering"]),r=new Set(["removePivotHeaderRowWhenSingleValueColumn","pivotRowTotals","pivotColumnGroupTotals","suppressExpandablePivotGroups"]),s=new Set(["getGroupRowAgg","alwaysAggregateAtRootLevel","groupIncludeTotalFooter","suppressAggFilteredOnly","grandTotalRow"]),n=new Set(["postSortRows","groupDisplayType","accentedSort"]),a=new Set([]),d=new Set(["groupRemoveSingleChildren","groupRemoveLowestSingleChildren","groupIncludeFooter","groupTotalRow"]),l=[...e,...t,...o,...r,...r,...s,...n,...a,...d];this.addManagedPropertyListeners(l,(l=>{const h=l.changeSet?.properties;if(!h)return;const c=e=>h.some((t=>e.has(t)));c(e)?this.setRowData(this.rootNode.allLeafChildren.map((e=>e.data))):c(t)?this.refreshModel({step:i.ClientSideRowModelSteps.EVERYTHING}):c(o)?this.refreshModel({step:i.ClientSideRowModelSteps.FILTER}):c(r)?this.refreshModel({step:i.ClientSideRowModelSteps.PIVOT}):c(s)?this.refreshModel({step:i.ClientSideRowModelSteps.AGGREGATE}):c(n)?this.refreshModel({step:i.ClientSideRowModelSteps.SORT}):c(a)?this.refreshModel({step:i.ClientSideRowModelSteps.FILTER_AGGREGATES}):c(d)&&this.refreshModel({step:i.ClientSideRowModelSteps.MAP})})),this.addManagedPropertyListener("rowHeight",(()=>this.resetRowHeights()))}start(){this.hasStarted=!0,this.shouldSkipSettingDataOnStart?this.dispatchUpdateEventsAndRefresh():this.setInitialData()}setInitialData(){const e=this.gos.get("rowData");e&&(this.shouldSkipSettingDataOnStart=!0,this.setRowData(e))}ensureRowHeightsValid(e,t,o,r){let s,n=!1;do{s=!1;const a=this.getRowIndexAtPixel(e),d=this.getRowIndexAtPixel(t),l=Math.max(a,o),h=Math.min(d,r);for(let e=l;e<=h;e++){const t=this.getRow(e);if(t.rowHeightEstimated){const e=(0,i._getRowHeightForNode)(this.gos,t);t.setRowHeight(e.height),s=!0,n=!0}}s&&this.setRowTopAndRowIndex()}while(s);return n}setRowTopAndRowIndex(){const e=this.environment.getDefaultRowHeight();let t=0;const o=new Set,r=(0,i._isDomLayout)(this.gos,"normal");for(let s=0;s<this.rowsToDisplay.length;s++){const n=this.rowsToDisplay[s];if(null!=n.id&&o.add(n.id),null==n.rowHeight){const t=(0,i._getRowHeightForNode)(this.gos,n,r,e);n.setRowHeight(t.height,t.estimated)}n.setRowTop(t),n.setRowIndex(s),t+=n.rowHeight}return o}clearRowTopAndRowIndex(e,t){const o=e.isActive(),i=e=>{e&&null!=e.id&&!t.has(e.id)&&e.clearRowTopAndRowIndex()},r=e=>{if(i(e),i(e.detailNode),i(e.sibling),e.hasChildren()&&e.childrenAfterGroup){const t=-1==e.level;o&&!t&&!e.expanded||e.childrenAfterGroup.forEach(r)}};r(this.rootNode)}ensureRowsAtPixel(e,t,o=0){const r=this.getRowIndexAtPixel(t),s=this.getRow(r),n=!this.gos.get("suppressAnimationFrame");if(s===e[0])return!1;const a=this.rootNode.allLeafChildren;return e.forEach((e=>{(0,i._removeFromArray)(a,e)})),e.forEach(((e,t)=>{(0,i._insertIntoArray)(a,e,Math.max(r+o,0)+t)})),e.forEach(((e,t)=>{e.sourceRowIndex=t})),this.refreshModel({step:i.ClientSideRowModelSteps.EVERYTHING,keepRenderedRows:!0,keepEditingRows:!0,animate:n,rowNodesOrderChanged:!0}),!0}highlightRowAtPixel(e,t){const o=null!=t?this.getRowIndexAtPixel(t):null,i=null!=o?this.getRow(o):null;if(!i||!e||null==t)return void this.clearHighlightedRow();const r=this.getHighlightPosition(t,i),s=this.isHighlightingCurrentPosition(e,i,r),n=null!=this.lastHighlightedRow&&this.lastHighlightedRow!==i;(s||n)&&(this.clearHighlightedRow(),s)||(i.setHighlighted(r),this.lastHighlightedRow=i)}getHighlightPosition(e,t){if(!t){const o=this.getRowIndexAtPixel(e);if(!(t=this.getRow(o||0)))return i.RowHighlightPosition.Below}const{rowTop:o,rowHeight:r}=t;return e-o<r/2?i.RowHighlightPosition.Above:i.RowHighlightPosition.Below}getLastHighlightedRowNode(){return this.lastHighlightedRow}isHighlightingCurrentPosition(e,t,o){if(e===t)return!0;const r=o===i.RowHighlightPosition.Above?-1:1;return this.getRow(t.rowIndex+r)===e}clearHighlightedRow(){this.lastHighlightedRow&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null)}isLastRowIndexKnown(){return!0}getRowCount(){return this.rowsToDisplay?this.rowsToDisplay.length:0}getTopLevelRowCount(){if(0===this.rowsToDisplay.length)return 0;if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return 1;const e=this.rootNode.childrenAfterAggFilter,t=this.rootNode.sibling?1:0;return(e?e.length:0)+t}getTopLevelRowDisplayedIndex(e){if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return e;let t=e;if(this.rowsToDisplay[0].footer){if(0===e)return 0;t-=1}const o=this.rowsToDisplay[this.rowsToDisplay.length-1],i=t>=this.rootNode.childrenAfterSort.length;if(o.footer&&i)return o.rowIndex;let r=this.rootNode.childrenAfterSort[t];if(this.gos.get("groupHideOpenParents"))for(;r.expanded&&r.childrenAfterSort&&r.childrenAfterSort.length>0;)r=r.childrenAfterSort[0];return r.rowIndex}getRowBounds(e){if((0,i._missing)(this.rowsToDisplay))return null;const t=this.rowsToDisplay[e];return t?{rowTop:t.rowTop,rowHeight:t.rowHeight}:null}onRowGroupOpened(){const e=(0,i._isAnimateRows)(this.gos);this.refreshModel({step:i.ClientSideRowModelSteps.MAP,keepRenderedRows:!0,animate:e})}onFilterChanged(e){if(e.afterDataChange)return;const t=(0,i._isAnimateRows)(this.gos),o=0===e.columns.length||e.columns.some((e=>e.isPrimary()))?i.ClientSideRowModelSteps.FILTER:i.ClientSideRowModelSteps.FILTER_AGGREGATES;this.refreshModel({step:o,keepRenderedRows:!0,animate:t})}onSortChanged(){const e=(0,i._isAnimateRows)(this.gos);this.refreshModel({step:i.ClientSideRowModelSteps.SORT,keepRenderedRows:!0,animate:e,keepEditingRows:!0})}getType(){return"clientSide"}onValueChanged(){this.columnModel.isPivotActive()?this.refreshModel({step:i.ClientSideRowModelSteps.PIVOT}):this.refreshModel({step:i.ClientSideRowModelSteps.AGGREGATE})}createChangePath(e){const t=(0,i._missingOrEmpty)(e),o=new i.ChangedPath(!1,this.rootNode);return t&&o.setInactive(),o}isSuppressModelUpdateAfterUpdateTransaction(e){if(!this.gos.get("suppressModelUpdateAfterUpdateTransaction"))return!1;if(null==e.rowNodeTransactions)return!1;const t=e.rowNodeTransactions.filter((e=>null!=e.add&&e.add.length>0||null!=e.remove&&e.remove.length>0));return null==t||0==t.length}buildRefreshModelParams(e){let t=i.ClientSideRowModelSteps.EVERYTHING;const o={everything:i.ClientSideRowModelSteps.EVERYTHING,group:i.ClientSideRowModelSteps.EVERYTHING,filter:i.ClientSideRowModelSteps.FILTER,map:i.ClientSideRowModelSteps.MAP,aggregate:i.ClientSideRowModelSteps.AGGREGATE,filter_aggregates:i.ClientSideRowModelSteps.FILTER_AGGREGATES,sort:i.ClientSideRowModelSteps.SORT,pivot:i.ClientSideRowModelSteps.PIVOT,nothing:i.ClientSideRowModelSteps.NOTHING};if((0,i._exists)(e)&&(t=o[e]),!(0,i._missing)(t))return{step:t,keepRenderedRows:!0,keepEditingRows:!0,animate:!this.gos.get("suppressAnimationFrame")};(0,i._errorOnce)(`invalid step ${e}, available steps are ${Object.keys(o).join(", ")}`)}refreshModel(e){if(!this.hasStarted||this.isRefreshingModel||this.columnModel.isChangeEventsDispatching())return;const t="object"==typeof e&&"step"in e?e:this.buildRefreshModelParams(e);if(!t)return;if(this.isSuppressModelUpdateAfterUpdateTransaction(t))return;const o=this.createChangePath(t.rowNodeTransactions);switch(this.isRefreshingModel=!0,t.step){case i.ClientSideRowModelSteps.EVERYTHING:this.doRowGrouping(t.rowNodeTransactions,o,!!t.rowNodesOrderChanged,!!t.afterColumnsChanged);case i.ClientSideRowModelSteps.FILTER:this.doFilter(o);case i.ClientSideRowModelSteps.PIVOT:this.doPivot(o);case i.ClientSideRowModelSteps.AGGREGATE:this.doAggregate(o);case i.ClientSideRowModelSteps.FILTER_AGGREGATES:this.doFilterAggregates(o);case i.ClientSideRowModelSteps.SORT:this.doSort(t.rowNodeTransactions,o);case i.ClientSideRowModelSteps.MAP:this.doRowsToDisplay()}const r=this.setRowTopAndRowIndex();this.clearRowTopAndRowIndex(o,r),this.isRefreshingModel=!1,this.eventService.dispatchEvent({type:"modelUpdated",animate:t.animate,keepRenderedRows:t.keepRenderedRows,newData:t.newData,newPage:!1,keepUndoRedoStack:t.keepUndoRedoStack})}isEmpty(){const e=(0,i._missing)(this.rootNode.allLeafChildren)||0===this.rootNode.allLeafChildren.length;return(0,i._missing)(this.rootNode)||e||!this.columnModel.isReady()}isRowsToRender(){return(0,i._exists)(this.rowsToDisplay)&&this.rowsToDisplay.length>0}getNodesInRangeForSelection(e,t){let o=!1,r=!1;const s=[],n=(0,i._getGroupSelectsDescendants)(this.gos);return this.forEachNodeAfterFilterAndSort((i=>{if(!r)if(o&&(i===t||i===e)&&(r=!0,i.group&&n))s.push(...i.allLeafChildren);else{if(!o){if(i!==t&&i!==e)return;o=!0}(!i.group||!n)&&s.push(i)}})),s}setDatasource(e){(0,i._errorOnce)("should never call setDatasource on clientSideRowController")}getTopLevelNodes(){return this.rootNode?this.rootNode.childrenAfterGroup:null}getRootNode(){return this.rootNode}getRow(e){return this.rowsToDisplay[e]}isRowPresent(e){return this.rowsToDisplay.indexOf(e)>=0}getRowIndexAtPixel(e){if(this.isEmpty()||0===this.rowsToDisplay.length)return-1;let t=0,o=this.rowsToDisplay.length-1;if(e<=0)return 0;if((0,i._last)(this.rowsToDisplay).rowTop<=e)return this.rowsToDisplay.length-1;let r=-1,s=-1;for(;;){const i=Math.floor((t+o)/2),n=this.rowsToDisplay[i];if(this.isRowInPixel(n,e))return i;if(n.rowTop<e?t=i+1:n.rowTop>e&&(o=i-1),r===t&&s===o)return i;r=t,s=o}}isRowInPixel(e,t){const o=e.rowTop,i=e.rowTop+e.rowHeight;return o<=t&&i>t}forEachLeafNode(e){this.rootNode.allLeafChildren&&this.rootNode.allLeafChildren.forEach(((t,o)=>e(t,o)))}forEachNode(e,t=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterGroup||[]],callback:e,recursionType:0,index:0,includeFooterNodes:t})}forEachNodeAfterFilter(e,t=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterAggFilter||[]],callback:e,recursionType:1,index:0,includeFooterNodes:t})}forEachNodeAfterFilterAndSort(e,t=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterSort||[]],callback:e,recursionType:2,index:0,includeFooterNodes:t})}forEachPivotNode(e,t=!1){this.recursivelyWalkNodesAndCallback({nodes:[this.rootNode],callback:e,recursionType:3,index:0,includeFooterNodes:t})}recursivelyWalkNodesAndCallback(e){const{nodes:t,callback:o,recursionType:r,includeFooterNodes:s}=e;let{index:n}=e;const a=e=>{const r=t[0]?.parent;if(!r)return;const a=s&&(0,i._getGrandTotalRow)(this.gos),d=(0,i._getGroupTotalRowCallback)(this.gos),l=s&&d({node:r});r===this.rootNode?a===e&&(r.createFooter(),o(r.sibling,n++)):l===e&&(r.createFooter(),o(r.sibling,n++))};a("top");for(let e=0;e<t.length;e++){const i=t[e];if(o(i,n++),i.hasChildren()&&!i.footer){let e=null;switch(r){case 0:e=i.childrenAfterGroup;break;case 1:e=i.childrenAfterAggFilter;break;case 2:e=i.childrenAfterSort;break;case 3:e=i.leafGroup?null:i.childrenAfterSort}e&&(n=this.recursivelyWalkNodesAndCallback({nodes:[...e],callback:o,recursionType:r,index:n,includeFooterNodes:s}))}}return a("bottom"),n}doAggregate(e){this.aggregationStage?.execute({rowNode:this.rootNode,changedPath:e})}doFilterAggregates(e){this.filterAggregatesStage?this.filterAggregatesStage.execute({rowNode:this.rootNode,changedPath:e}):this.rootNode.childrenAfterAggFilter=this.rootNode.childrenAfterFilter}expandOrCollapseAll(e){const t=this.gos.get("treeData"),o=this.columnModel.isPivotActive(),r=s=>{s&&s.forEach((s=>{const n=()=>{s.expanded=e,r(s.childrenAfterGroup)};t?(0,i._exists)(s.childrenAfterGroup)&&n():o?!s.leafGroup&&n():s.group&&n()}))};this.rootNode&&r(this.rootNode.childrenAfterGroup),this.refreshModel({step:i.ClientSideRowModelSteps.MAP}),this.eventService.dispatchEvent({type:"expandOrCollapseAll",source:e?"expandAll":"collapseAll"})}doSort(e,t){this.sortStage.execute({rowNode:this.rootNode,rowNodeTransactions:e,changedPath:t})}doRowGrouping(e,t,o,r){if(this.groupStage)e?this.groupStage.execute({rowNode:this.rootNode,rowNodeTransactions:e,rowNodesOrderChanged:o,changedPath:t}):this.groupStage.execute({rowNode:this.rootNode,changedPath:t,afterColumnsChanged:r}),(0,i._getGroupSelectsDescendants)(this.gos)&&this.selectionService.updateGroupsFromChildrenSelections("rowGroupChanged",t)&&this.eventService.dispatchEvent({type:"selectionChanged",source:"rowGroupChanged"});else{const e=this.rootNode,t=e.sibling;e.childrenAfterGroup=e.allLeafChildren,t&&(t.childrenAfterGroup=e.childrenAfterGroup),this.rootNode.updateHasChildren()}this.nodeManager.isRowCountReady()&&(this.rowCountReady=!0,this.eventService.dispatchEventOnce({type:"rowCountReady"}))}doFilter(e){this.filterStage.execute({rowNode:this.rootNode,changedPath:e})}doPivot(e){this.pivotStage?.execute({rowNode:this.rootNode,changedPath:e})}getNodeManager(){return this.nodeManager}getRowNode(e){if("string"==typeof e&&0==e.indexOf(i.RowNode.ID_PREFIX_ROW_GROUP)){let t;return this.forEachNode((o=>{o.id===e&&(t=o)})),t}return this.nodeManager.getRowNode(e)}setRowData(e){this.selectionService.reset("rowDataChanged"),this.nodeManager.setRowData(e),this.hasStarted&&this.dispatchUpdateEventsAndRefresh()}dispatchUpdateEventsAndRefresh(){this.eventService.dispatchEvent({type:"rowDataUpdated"}),this.refreshModel({step:i.ClientSideRowModelSteps.EVERYTHING,newData:!0})}batchUpdateRowData(e,t){if(null==this.applyAsyncTransactionsTimeout){this.rowDataTransactionBatch=[];const e=this.gos.get("asyncTransactionWaitMillis");this.applyAsyncTransactionsTimeout=window.setTimeout((()=>{this.isAlive()&&this.executeBatchUpdateRowData()}),e)}this.rowDataTransactionBatch.push({rowDataTransaction:e,callback:t})}flushAsyncTransactions(){null!=this.applyAsyncTransactionsTimeout&&(clearTimeout(this.applyAsyncTransactionsTimeout),this.executeBatchUpdateRowData())}executeBatchUpdateRowData(){this.valueCache.onDataChanged();const e=[],t=[];let o=!1;this.rowDataTransactionBatch?.forEach((i=>{const{rowNodeTransaction:r,rowsInserted:s}=this.nodeManager.updateRowData(i.rowDataTransaction);s&&(o=!0),t.push(r),i.callback&&e.push(i.callback.bind(null,r))})),this.commonUpdateRowData(t,o),e.length>0&&window.setTimeout((()=>{e.forEach((e=>e()))}),0),t.length>0&&this.eventService.dispatchEvent({type:"asyncTransactionsFlushed",results:t}),this.rowDataTransactionBatch=null,this.applyAsyncTransactionsTimeout=void 0}updateRowData(e){this.valueCache.onDataChanged();const{rowNodeTransaction:t,rowsInserted:o}=this.nodeManager.updateRowData(e);return this.commonUpdateRowData([t],o),t}afterImmutableDataChange(e,t){this.commonUpdateRowData([e],t)}commonUpdateRowData(e,t){if(!this.hasStarted)return;const o=!this.gos.get("suppressAnimationFrame");this.eventService.dispatchEvent({type:"rowDataUpdated"}),this.refreshModel({step:i.ClientSideRowModelSteps.EVERYTHING,rowNodeTransactions:e,rowNodesOrderChanged:t,keepRenderedRows:!0,keepEditingRows:!0,animate:o})}doRowsToDisplay(){this.rowsToDisplay=this.flattenStage.execute({rowNode:this.rootNode})}onRowHeightChanged(){this.refreshModel({step:i.ClientSideRowModelSteps.MAP,keepRenderedRows:!0,keepEditingRows:!0,keepUndoRedoStack:!0})}onRowHeightChangedDebounced(){this.onRowHeightChanged_debounced()}resetRowHeights(){const e=this.resetRowHeightsForAllRowNodes();this.rootNode.setRowHeight(this.rootNode.rowHeight,!0),this.rootNode.sibling&&this.rootNode.sibling.setRowHeight(this.rootNode.sibling.rowHeight,!0),e&&this.onRowHeightChanged()}resetRowHeightsForAllRowNodes(){let e=!1;return this.forEachNode((t=>{t.setRowHeight(t.rowHeight,!0);const o=t.detailNode;o&&o.setRowHeight(o.rowHeight,!0),t.sibling&&t.sibling.setRowHeight(t.sibling.rowHeight,!0),e=!0})),e}onGridStylesChanges(e){if(e.rowHeightChanged){if(this.columnModel.isAutoRowHeightActive())return;this.resetRowHeights()}}onGridReady(){this.hasStarted||this.setInitialData()}isRowDataLoaded(){return this.rowCountReady}destroy(){super.destroy(),this.clearHighlightedRow()}},n=class extends i.BeanStub{constructor(){super(...arguments),this.beanName="filterStage"}wireBeans(e){this.filterManager=e.filterManager}execute(e){const{changedPath:t}=e;this.filter(t)}filter(e){const t=!!this.filterManager?.isChildFilterPresent();this.filterNodes(t,e)}filterNodes(e,t){const o=(t,o)=>{t.hasChildren()?t.childrenAfterFilter=e&&!o?t.childrenAfterGroup.filter((e=>{const t=e.childrenAfterFilter&&e.childrenAfterFilter.length>0,o=e.data&&this.filterManager.doesRowPassFilter({rowNode:e});return t||o})):t.childrenAfterGroup:t.childrenAfterFilter=t.childrenAfterGroup,t.sibling&&(t.sibling.childrenAfterFilter=t.childrenAfterFilter)};if(this.doingTreeDataFiltering()){const e=(t,i)=>{if(t.childrenAfterGroup)for(let r=0;r<t.childrenAfterGroup.length;r++){const s=t.childrenAfterGroup[r],n=i||this.filterManager.doesRowPassFilter({rowNode:s});s.childrenAfterGroup?e(t.childrenAfterGroup[r],n):o(s,n)}o(t,i)},i=t=>e(t,!1);t.executeFromRootNode(i)}else{const e=e=>o(e,!1);t.forEachChangedNodeDepthFirst(e,!0)}}doingTreeDataFiltering(){return this.gos.get("treeData")&&!this.gos.get("excludeChildrenWhenTreeDataFiltering")}},a=class extends i.BeanStub{constructor(){super(...arguments),this.beanName="flattenStage"}wireBeans(e){this.beans=e,this.columnModel=e.columnModel}execute(e){const t=e.rowNode,o=[],i=this.columnModel.isPivotMode(),r=i&&t.leafGroup,s=r?[t]:t.childrenAfterSort,n=this.getFlattenDetails();if(this.recursivelyAddToRowsToDisplay(n,s,o,i,0),!r&&o.length>0&&n.grandTotalRow){t.createFooter();const e="top"===n.grandTotalRow;this.addRowNodeToRowsToDisplay(n,t.sibling,o,0,e)}return o}getFlattenDetails(){const e=this.gos.get("groupRemoveSingleChildren");return{groupRemoveLowestSingleChildren:!e&&this.gos.get("groupRemoveLowestSingleChildren"),groupRemoveSingleChildren:e,isGroupMultiAutoColumn:(0,i._isGroupMultiAutoColumn)(this.gos),hideOpenParents:this.gos.get("groupHideOpenParents"),grandTotalRow:(0,i._getGrandTotalRow)(this.gos),groupTotalRow:(0,i._getGroupTotalRowCallback)(this.gos)}}recursivelyAddToRowsToDisplay(e,t,o,r,s){if(!(0,i._missingOrEmpty)(t))for(let i=0;i<t.length;i++){const n=t[i],a=n.hasChildren(),d=r&&!a,l=e.groupRemoveSingleChildren&&a&&1===n.childrenAfterGroup.length,h=e.groupRemoveLowestSingleChildren&&a&&n.leafGroup&&1===n.childrenAfterGroup.length,c=r&&n.leafGroup,g=e.hideOpenParents&&n.expanded&&!n.master&&!c;if(!(d||g||l||h)&&this.addRowNodeToRowsToDisplay(e,n,o,s),!r||!n.leafGroup)if(a){const t=l||h;if(n.expanded||t){const i=e.groupTotalRow({node:n});i||n.destroyFooter();const a=t?s:s+1;"top"===i&&(n.createFooter(),this.addRowNodeToRowsToDisplay(e,n.sibling,o,a)),this.recursivelyAddToRowsToDisplay(e,n.childrenAfterSort,o,r,a),"bottom"===i&&(n.createFooter(),this.addRowNodeToRowsToDisplay(e,n.sibling,o,a))}}else if(n.master&&n.expanded){const t=this.createDetailNode(n);this.addRowNodeToRowsToDisplay(e,t,o,s)}}}addRowNodeToRowsToDisplay(e,t,o,i,r){r?o.unshift(t):o.push(t),t.setUiLevel(e.isGroupMultiAutoColumn?0:i)}createDetailNode(e){if((0,i._exists)(e.detailNode))return e.detailNode;const t=new i.RowNode(this.beans);return t.detail=!0,t.selectable=!1,t.parent=e,(0,i._exists)(e.id)&&(t.id="detail_"+e.id),t.data=e.data,t.level=e.level+1,e.detailNode=t,t}},d=class extends i.BeanStub{constructor(){super(...arguments),this.beanName="immutableService"}wireBeans(e){this.rowModel=e.rowModel,this.selectionService=e.selectionService}postConstruct(){(0,i._isClientSideRowModel)(this.gos)&&(this.clientSideRowModel=this.rowModel,this.addManagedPropertyListener("rowData",(()=>this.onRowDataUpdated())))}isActive(){const e=this.gos.exists("getRowId");return!this.gos.get("resetRowDataOnUpdate")&&e}setRowData(e){const t=this.createTransactionForRowData(e);if(!t)return;const o=this.clientSideRowModel.getNodeManager(),{rowNodeTransaction:i,rowsInserted:r}=o.updateRowData(t);let s=!1;this.gos.get("suppressMaintainUnsortedOrder")||(s=o.updateRowOrderFromRowData(e)),this.clientSideRowModel.afterImmutableDataChange(i,s||r)}createTransactionForRowData(e){if(!(0,i._isClientSideRowModel)(this.gos))return(0,i._errorOnce)("ImmutableService only works with ClientSideRowModel"),null;const t=(0,i._getRowIdCallback)(this.gos);if(null==t)return(0,i._errorOnce)("ImmutableService requires getRowId() callback to be implemented, your row data needs IDs!"),null;const o=this.clientSideRowModel.getNodeManager().getCopyOfNodesMap(),r=[],s=[],n=[];return(0,i._exists)(e)&&e.forEach((e=>{const i=t({data:e,level:0}),r=o[i];r?(r.data!==e&&s.push(e),o[i]=void 0):n.push(e)})),(0,i._iterateObject)(o,((e,t)=>{t&&r.push(t.data)})),{remove:r,update:s,add:n}}onRowDataUpdated(){const e=this.gos.get("rowData");e&&(this.isActive()?this.setRowData(e):(this.selectionService.reset("rowDataChanged"),this.clientSideRowModel.setRowData(e)))}},l=class extends i.BeanStub{constructor(){super(...arguments),this.beanName="sortService"}wireBeans(e){this.columnModel=e.columnModel,this.funcColsService=e.funcColsService,this.rowNodeSorter=e.rowNodeSorter,this.showRowGroupColsService=e.showRowGroupColsService}sort(e,t,o,i,r,s){const n=this.gos.get("groupMaintainOrder"),a=this.columnModel.getCols().some((e=>e.isRowGroupActive()));let d={};o&&i&&(d=this.calculateDirtyNodes(i));const l=this.columnModel.isPivotMode(),h=this.gos.getCallback("postSortRows");r&&r.forEachChangedNodeDepthFirst((i=>{this.pullDownGroupDataForHideOpenParents(i.childrenAfterAggFilter,!0);const c=l&&i.leafGroup;if(n&&a&&!i.leafGroup&&!s){const e=this.funcColsService.getRowGroupColumns()?.[i.level+1],t=null===e?.getSort(),o=i.childrenAfterAggFilter.slice(0);if(i.childrenAfterSort&&!t){const e={};i.childrenAfterSort.forEach(((t,o)=>{e[t.id]=o})),o.sort(((t,o)=>(e[t.id]??0)-(e[o.id]??0)))}i.childrenAfterSort=o}else i.childrenAfterSort=!t||c?i.childrenAfterAggFilter.slice(0):o?this.doDeltaSort(i,d,r,e):this.rowNodeSorter.doFullSort(i.childrenAfterAggFilter,e);if(i.sibling&&(i.sibling.childrenAfterSort=i.childrenAfterSort),this.updateChildIndexes(i),h){const e={nodes:i.childrenAfterSort};h(e)}})),this.updateGroupDataForHideOpenParents(r)}calculateDirtyNodes(e){const t={},o=e=>{e&&e.forEach((e=>t[e.id]=!0))};return e&&e.forEach((e=>{o(e.add),o(e.update),o(e.remove)})),t}doDeltaSort(e,t,o,i){const r=e.childrenAfterAggFilter,s=e.childrenAfterSort;if(!s)return this.rowNodeSorter.doFullSort(r,i);const n={},a=[];r.forEach((e=>{t[e.id]||!o.canSkip(e)?a.push(e):n[e.id]=!0}));const d=s.filter((e=>n[e.id])),l=(e,t)=>({currentPos:t,rowNode:e}),h=a.map(l).sort(((e,t)=>this.rowNodeSorter.compareRowNodes(i,e,t)));return this.mergeSortedArrays(i,h,d.map(l)).map((({rowNode:e})=>e))}mergeSortedArrays(e,t,o){const i=[];let r=0,s=0;for(;r<t.length&&s<o.length;)this.rowNodeSorter.compareRowNodes(e,t[r],o[s])<0?i.push(t[r++]):i.push(o[s++]);for(;r<t.length;)i.push(t[r++]);for(;s<o.length;)i.push(o[s++]);return i}updateChildIndexes(e){if((0,i._missing)(e.childrenAfterSort))return;const t=e.childrenAfterSort;for(let o=0;o<t.length;o++){const i=t[o],r=0===o,s=o===e.childrenAfterSort.length-1;i.setFirstChild(r),i.setLastChild(s),i.setChildIndex(o)}}updateGroupDataForHideOpenParents(e){if(!this.gos.get("groupHideOpenParents"))return;if(this.gos.get("treeData"))return(0,i._warnOnce)("The property hideOpenParents dose not work with Tree Data. This is because Tree Data has values at the group level, it doesn't make sense to hide them."),!1;const t=e=>{this.pullDownGroupDataForHideOpenParents(e.childrenAfterSort,!1),e.childrenAfterSort.forEach((e=>{e.hasChildren()&&t(e)}))};e&&e.executeFromRootNode((e=>t(e)))}pullDownGroupDataForHideOpenParents(e,t){this.gos.get("groupHideOpenParents")&&!(0,i._missing)(e)&&e.forEach((e=>{(this.showRowGroupColsService?.getShowRowGroupCols()??[]).forEach((o=>{const r=o.getColDef().showRowGroup;if("string"!=typeof r)return void(0,i._errorOnce)("groupHideOpenParents only works when specifying specific columns for colDef.showRowGroup");const s=r,n=this.columnModel.getColDefCol(s);if(n!==e.rowGroupColumn)if(t)e.setGroupValue(o.getId(),void 0);else{const t=this.getFirstChildOfFirstChild(e,n);t&&e.setGroupValue(o.getId(),t.key)}}))}))}getFirstChildOfFirstChild(e,t){let o=e;for(;o;){const e=o.parent;if(!e||!o.firstChild)return null;if(e.rowGroupColumn===t)return e;o=e}return null}},h=class extends i.BeanStub{constructor(){super(...arguments),this.beanName="sortStage"}wireBeans(e){this.sortService=e.sortService,this.sortController=e.sortController}execute(e){const t=this.sortController.getSortOptions(),o=(0,i._exists)(t)&&t.length>0,r=o&&(0,i._exists)(e.rowNodeTransactions)&&this.gos.get("deltaSort"),s=t.some((e=>(0,i._isColumnsSortingCoupledToGroup)(this.gos)?e.column.isPrimary()&&e.column.isRowGroupActive():!!e.column.getColDef().showRowGroup));this.sortService.sort(t,o,r,e.rowNodeTransactions,e.changedPath,s)}},c="32.3.2",g=(0,i._defineModule)({version:c,moduleName:`${i.ModuleNames.ClientSideRowModelModule}-core`,rowModel:"clientSide",beans:[s,n,h,a,l,d]}),u=(0,i._defineModule)({version:c,moduleName:`${i.ModuleNames.ClientSideRowModelModule}-api`,beans:[i.RowModelHelperService],apiFunctions:{onGroupExpandedOrCollapsed:function(e){e.expansionService.onGroupExpandedOrCollapsed()},refreshClientSideRowModel:function(e,t){e.rowModelHelperService?.getClientSideRowModel()?.refreshModel(t)},isRowDataEmpty:function(e){return e.rowModelHelperService?.getClientSideRowModel()?.isEmpty()??!0},forEachLeafNode:function(e,t){e.rowModelHelperService?.getClientSideRowModel()?.forEachLeafNode(t)},forEachNodeAfterFilter:function(e,t){e.rowModelHelperService?.getClientSideRowModel()?.forEachNodeAfterFilter(t)},forEachNodeAfterFilterAndSort:function(e,t){e.rowModelHelperService?.getClientSideRowModel()?.forEachNodeAfterFilterAndSort(t)},resetRowHeights:function(e){e.columnModel.isAutoRowHeightActive()?(0,i._warnOnce)("calling gridApi.resetRowHeights() makes no sense when using Auto Row Height."):e.rowModelHelperService?.getClientSideRowModel()?.resetRowHeights()},applyTransaction:function(e,t){return e.frameworkOverrides.wrapIncoming((()=>e.rowModelHelperService?.getClientSideRowModel()?.updateRowData(t)))},applyTransactionAsync:function(e,t,o){e.frameworkOverrides.wrapIncoming((()=>e.rowModelHelperService?.getClientSideRowModel()?.batchUpdateRowData(t,o)))},flushAsyncTransactions:function(e){e.frameworkOverrides.wrapIncoming((()=>e.rowModelHelperService?.getClientSideRowModel()?.flushAsyncTransactions()))},getBestCostNodeSelection:function(e){return e.selectionService.getBestCostNodeSelection()}},dependantModules:[g,i._CsrmSsrmSharedApiModule]}),p=(0,i._defineModule)({version:c,moduleName:i.ModuleNames.ClientSideRowModelModule,dependantModules:[g,u]})}}]);