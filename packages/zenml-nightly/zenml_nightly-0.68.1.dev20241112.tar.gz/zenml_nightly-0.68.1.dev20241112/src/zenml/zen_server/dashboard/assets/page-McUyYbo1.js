import{r as l,j as e}from"./@radix-DP6vWzyx.js";import{a9 as O,aa as F,ab as _,F as L,l as B,m as H,i as $,r as g,j as q,aj as M,al as U,at as W,an as Q,f as u,D as v,q as G,s as Y,V as K,Y as V,Z,$ as J,S as x,A as D,b as T,B as X,ac as ee,z as j,G as se,aG as te}from"./index-QQb7wQEC.js";import{S as ae}from"./plus-C9IxgN2M.js";import{S as re}from"./refresh-BVu22P_C.js";import{S as ne,P as ie}from"./SearchField-DfUiGFVd.js";import{s as p}from"./sharedSchema-TMLu-nYQ.js";import{b as ce,c as le,a as h}from"./@tanstack-BUCbhJyH.js";import{b as oe,L as b,c as de}from"./@react-router-BMhZulnd.js";import{C as w}from"./CopyButton-C745BrKi.js";import{D as me}from"./DisplayDate-BeXgUG_C.js";import{I as ue}from"./InlineAvatar-jEgodSgX.js";import{S as xe}from"./dots-horizontal-DK5Duzx4.js";import{D as pe,S as he}from"./DialogItem-DcVCZEew.js";import{S as fe}from"./trash-DkJHMOg7.js";import{I as k}from"./Infobox-BwisKifi.js";import{C as N}from"./CodeSnippet-CqybNv0k.js";import{A as je}from"./AlertDialogDropdownItem-C6N2rGrB.js";import{C as ge}from"./CollapsibleCard-0r_8G2Lj.js";import{S as ye}from"./chevron-right-double-DoD8iXWM.js";import{e as S}from"./components-Br2ezRib.js";import{s as Ne}from"./url-D5le3J4q.js";import{N as C}from"./NumberBox-T9eELfLZ.js";import{C as be}from"./ComponentBadge-DUiEYJHu.js";import{C as we}from"./ComponentFallbackDialog-BFoH5K4V.js";import{p as A,c as ke}from"./persist-DNb5cdrU.js";import{p as E,c as ve}from"./persist-CP0JmYZ4.js";import"./@reactflow-8U9qNlMR.js";import"./index-BVJ8n2-j.js";import"./stack-detail-query-xmYxSsUY.js";import"./copy-CaSMXwiU.js";import"./chevron-down-8wLBS5pQ.js";import"./ComponentIcon-CAIoUis2.js";import"./layout-DCSYN7-C.js";import"./rocket-CONEmRmB.js";const R=l.forwardRef(({closeModal:s,name:t,...a},r)=>e.jsxs(O,{...a,ref:r,children:[e.jsx(F,{children:e.jsx(_,{children:"Update Stack"})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(Se,{action:"update"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Update a stack"}),e.jsx(N,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack update ${t} -o NEW_ORCHESTRATOR_NAME`})]})]})]}));R.displayName="UpdateStackDialog";function Se({action:s}){function t(){switch(s){case"delete":return"delete";case"update":return"update";case"describe":return"get details of"}}return e.jsx(k,{children:e.jsx("div",{className:"flex w-full flex-wrap justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold",children:"We are working on the new Stacks experience."}),e.jsxs("p",{className:"truncate text-text-sm",children:["Meanwhile you can use the CLI to ",t()," your stack."]})]})})})}async function Ce({stackId:s},t){const a=B(H.stacks.detail(s)),r=await fetch(a,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok){const i=await r.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>`Error while deleting stack ${s}`);throw new L({status:r.status,statusText:r.statusText,message:i})}return r.json()}function De(s){return ce({...s,mutationFn:async({stackId:t})=>Ce({stackId:t})})}function Te(s){const{toast:t}=$(),a=le(),r=oe(),i=De({onSuccess:async()=>{a.invalidateQueries({queryKey:p.all}),r(g.stacks.overview)},onError:c=>{t({status:"error",emphasis:"subtle",icon:e.jsx(q,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:c.message,rounded:!0})}});function n(){i.mutate({stackId:s})}return{handleDelete:n,deleteStack:i}}const P=l.forwardRef(({closeModal:s,name:t,stackId:a,...r},i)=>{const{handleDelete:n,deleteStack:c}=Te(a);return e.jsxs(M,{...r,className:"p-0",ref:i,children:[e.jsxs(U,{className:"m-0 py-2 pl-5 pr-3 text-text-lg font-semibold",children:["Delete ",t]}),e.jsx("div",{className:"border-y border-theme-border-moderate px-5 py-5",children:e.jsxs(W,{children:["Are you sure you want to delete this stack? ",e.jsx("br",{}),"This action cannot be undone."]})}),e.jsxs("div",{className:"flex justify-end gap-3 px-5 py-3",children:[e.jsx(Q,{onClick:()=>s==null?void 0:s(),asChild:!0,children:e.jsx(u,{intent:"secondary",children:"Cancel"})}),e.jsxs(u,{disabled:c.isPending,type:"button",onClick:()=>n(),intent:"danger",children:[c.isPending&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-error"}),"Delete"]})]})]})});P.displayName="DeleteStackDialog";function Ae({name:s,id:t}){const[a,r]=l.useState(!1),[i,n]=l.useState(!1),c=l.useRef(null),d=l.useRef(null);function o(){d.current=c.current}function m(f){r(f),f===!1&&n(!1)}return e.jsx(v,{open:i,onOpenChange:n,children:e.jsxs(v,{children:[e.jsx(G,{className:"z-10",ref:c,children:e.jsx(xe,{className:"h-5 w-5 fill-theme-text-secondary"})}),e.jsxs(Y,{hidden:a,onCloseAutoFocus:f=>{d.current&&(d.current.focus(),d.current=null,f.preventDefault())},className:"z-10",align:"end",sideOffset:1,children:[e.jsx(pe,{onSelect:o,onOpenChange:m,icon:e.jsx(he,{className:"h-3 w-3 !fill-neutral-400"}),triggerChildren:"Update",children:e.jsx(R,{name:s,className:"lg:min-w-[600px]",closeModal:()=>m(!1)})}),e.jsx(je,{onSelect:o,onOpenChange:m,icon:e.jsx(fe,{className:"h-3  w-3 !fill-neutral-400"}),triggerChildren:"Delete",children:e.jsx(P,{stackId:t,name:s,className:"lg:min-w-[600px]",closeModal:()=>m(!1)})})]})]})})}function Ee(){return e.jsx("div",{className:"flex h-9 items-center border-b border-theme-border-moderate bg-theme-surface-primary px-4 py-3",children:e.jsxs(K,{className:"focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(ye,{className:"h-5 w-5 fill-neutral-500"}),e.jsx("span",{className:"sr-only",children:"Close"})]})})}const I=l.createContext(null);function Re({children:s}){const[t,a]=l.useState([]);return e.jsx(I.Provider,{value:{integrations:t,setIntegrations:a},children:s})}function z(){const s=l.useContext(I);if(s===null)throw new Error("useIntegrationsContext must be used within an AuthProvider");return s}function Pe({children:s,stackId:t,stackName:a}){return e.jsxs(V,{children:[e.jsx(Z,{children:s}),e.jsx(J,{className:"w-[1000px] overflow-y-auto",children:e.jsxs(Re,{children:[e.jsx(Ee,{}),e.jsx(Ie,{stackId:t}),e.jsx(Fe,{name:a}),e.jsx(ze,{stackId:t})]})})]})}function Ie({stackId:s}){const t=h({...p.stackDetail(s)});return t.isError?null:t.isPending?e.jsx("div",{className:"p-5",children:e.jsx(x,{className:"h-6 w-full"})}):e.jsxs("div",{className:"flex items-center space-x-2 border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsx(D,{type:"square",size:"lg",children:e.jsx(T,{size:"lg",children:t.data.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"mb-0.5 text-text-sm text-theme-text-secondary",children:t.data.id}),e.jsx(w,{copyText:t.data.id})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-display-xs font-semibold",children:t.data.name})})]})]})}function ze({stackId:s}){var i;const{setIntegrations:t}=z(),a=h({...p.stackDetail(s)});if(l.useEffect(()=>{var d;if(!a.data)return;const c=S((d=a.data.metadata)==null?void 0:d.components).map(o=>{var m;return(m=o.body)==null?void 0:m.integration}).filter(o=>!!o&&o!=="built-in"&&o!=="custom");c.length>=1&&t(o=>Array.from(new Set([...o,...c])))},[a.data]),a.isError)return null;if(a.isPending)return e.jsx("div",{className:"p-5",children:e.jsx(x,{className:"h-[300px] w-full"})});const r=S((i=a.data.metadata)==null?void 0:i.components);return e.jsx("ul",{className:"space-y-5 p-5",children:r.map(n=>e.jsx("li",{children:e.jsx(Oe,{component:n})},n.id))})}function Oe({component:s}){var t,a,r,i,n;return e.jsxs(X,{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{width:32,height:32,alt:`${(t=s.body)==null?void 0:t.flavor} logo`,src:Ne(((a=s.body)==null?void 0:a.logo_url)||"")}),e.jsxs("div",{children:[e.jsx(we,{type:((r=s.body)==null?void 0:r.type)||"orchestrator",name:s.name,children:e.jsx("button",{className:"text-text-xl",children:s.name})}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:s.id.split("-")[0]}),e.jsx(w,{copyText:s.id})]})]})]}),e.jsx(be,{type:((i=s.body)==null?void 0:i.type)||"orchestrator",children:ee(((n=s.body)==null?void 0:n.type)||"")})]})}function Fe({name:s}){const{integrations:t}=z();return e.jsx("section",{className:"px-5 pt-5",children:e.jsx(ge,{title:e.jsx("span",{className:"text-text-lg",children:"Set this stack"}),children:e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{children:"1"}),e.jsx("p",{className:"font-semibold",children:"Set your stack"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Set the stack as active on your client"}),e.jsx(N,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack set ${s}`})]})]}),t.length>=1&&e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{children:"2"}),e.jsx("p",{className:"font-semibold",children:"Install the integrations"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Install the required integrations to run pipelines in your stack"}),e.jsx(N,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml integration install ${t.join(" ")}`})]})]})]})})})}function _e(){return[{id:"name",header:"Stack",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{name:t,id:a}=s();return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(D,{type:"square",size:"md",children:e.jsx(T,{size:"md",children:t[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(Pe,{stackName:t,stackId:a,children:e.jsx("h2",{className:"text-text-md font-semibold",children:t})})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(w,{copyText:a})]})]})]})}},{id:"created",header:"Created at",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.created},cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(me,{dateString:s()})})},{id:"author",header:"Author",accessorFn:s=>{var t;return{author:(t=s.body)==null?void 0:t.user}},cell:({getValue:s})=>{const{author:t}=s();return t?e.jsx(ue,{username:t.name}):null}},{id:"actions",header:"",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{id:t,name:a}=s();return e.jsx(Ae,{name:a,id:t})}}]}function Le({setHasResumeableStack:s}){const{success:t,data:a}=A(),r=h({...p.stackDeploymentStack({provider:(a==null?void 0:a.provider)||"aws",stack_name:(a==null?void 0:a.stackName)||"",date_start:a==null?void 0:a.timestamp}),enabled:t,throwOnError:!0});return l.useEffect(()=>{r.data&&(ke(),s(!1))},[r.data]),!t||r.isError?null:r.isPending?e.jsx(x,{className:"h-[70px] w-full"}):e.jsx(k,{className:"w-full",children:e.jsxs("section",{className:"flex flex-wrap items-center justify-between gap-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"font-semibold",children:"You have a Stack provision incomplete"}),e.jsx("p",{className:"text-text-sm",children:"Return to the setup and finish the configuration on your cloud provider"})]}),e.jsx("div",{children:e.jsx(u,{className:"w-fit bg-theme-surface-primary",intent:"primary",emphasis:"subtle",asChild:!0,children:e.jsx(b,{to:g.stacks.create.newInfra,children:e.jsx("span",{children:"Review Stack"})})})})]})})}const y=1,Be=j.object({page:j.coerce.number().min(y).optional().default(y).catch(y),name:j.string().optional(),operator:j.enum(["and","or"]).optional()});function He(){const[s]=de(),{page:t,name:a,operator:r}=Be.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:t,name:a,logical_operator:r}}function $e({setHasResumeableTerraform:s}){const{success:t,data:a}=E(),r=h({...p.stackDeploymentStack({provider:(a==null?void 0:a.provider)||"aws",stack_name:(a==null?void 0:a.stackName)||"",date_start:a==null?void 0:a.timestamp}),enabled:t,throwOnError:!0});return l.useEffect(()=>{r.data&&(ve(),s(!1))},[r.data]),!t||r.isError?null:r.isPending?e.jsx(x,{className:"h-[70px] w-full"}):e.jsx(k,{className:"w-full",children:e.jsxs("section",{className:"flex flex-wrap items-center justify-between gap-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"font-semibold",children:"You have a Terraform Stack provision incomplete"}),e.jsx("p",{className:"text-text-sm",children:"Return to the setup and finish the configuration on your cloud provider"})]}),e.jsx("div",{children:e.jsx(u,{className:"w-fit bg-theme-surface-primary",intent:"primary",emphasis:"subtle",asChild:!0,children:e.jsx(b,{to:g.stacks.create.terraform,children:e.jsx("span",{children:"Review Stack"})})})})]})})}function qe(){const[s,t]=l.useState(A().success),[a,r]=l.useState(E().success),i=He(),{refetch:n,data:c}=h({...p.stackList({...i,sort_by:"desc:updated"}),throwOnError:!0});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx(ne,{searchParams:i}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(u,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>n(),children:[e.jsx(re,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e.jsx(u,{size:"md",asChild:!0,children:e.jsxs(b,{to:g.stacks.create.index,children:[e.jsx(ae,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Stack"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[s&&e.jsx(Le,{setHasResumeableStack:t}),a&&e.jsx($e,{setHasResumeableTerraform:r}),e.jsx("div",{className:"w-full",children:c?e.jsx(se,{columns:_e(),data:c.items}):e.jsx(x,{className:"h-[500px] w-full"})}),c?c.total_pages>1&&e.jsx(ie,{searchParams:i,paginate:c}):e.jsx(x,{className:"h-[36px] w-[300px]"})]})]})})}function ks(){const{setTourState:s,tourState:{tourActive:t}}=te();return l.useEffect(()=>{t&&s(a=>({...a,run:!0,stepIndex:a.stepIndex}))},[t]),e.jsx(qe,{})}export{ks as default};
