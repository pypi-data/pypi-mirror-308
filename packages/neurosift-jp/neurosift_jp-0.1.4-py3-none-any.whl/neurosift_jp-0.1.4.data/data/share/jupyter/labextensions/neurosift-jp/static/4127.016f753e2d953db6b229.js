(()=>{"use strict";var t={24127:()=>{let t,e,i,n,a,o,s=!1;onmessage=function(n){n.data.canvas&&(t=n.data.canvas,r()),n.data.opts&&(e=n.data.opts,r()),n.data.dataSeries&&(i=n.data.dataSeries,r()),n.data.annotation&&(a=n.data.annotation,r()),n.data.spikeTrains&&(o=n.data.spikeTrains,r()),void 0!==n.data.zoomInRequiredForSpikeTrains&&(console.log(n.data.zoomInRequiredForSpikeTrains),s=n.data.zoomInRequiredForSpikeTrains,r())};let l=0;const r=function(){let r=!1;return()=>{r||(r=!0,setTimeout((()=>{r=!1,async function(){if(!t)return;if(!e)return;const{margins:r,canvasWidth:h,canvasHeight:u,visibleStartTimeSec:p,visibleEndTimeSec:x,minValue:y,maxValue:b}=e;t.width=h,t.height=u;const g=t.getContext("2d");if(!g)return;l+=1;const S=l;g.clearRect(0,0,h,u),e.zoomInRequired&&!s&&(g.fillStyle="pink",g.textAlign="center",g.textBaseline="middle",g.font="20px Arial",g.fillText("Zoom in (mouse-wheel) to view data",h/2,u/2)),s&&(g.fillStyle="pink",g.textAlign="center",g.textBaseline="middle",g.font="20px Arial",g.fillText("Zoom in (mouse-wheel) to view spike trains",h/2,u/2)),o&&!s&&await m({canvasContext:g,canvasWidth:h,canvasHeight:u,visibleStartTimeSec:p,visibleEndTimeSec:x,margins:r,spikeTrains:o});for(const t of[1]){if(S!==l)return;const t=Date.now();n=i?f(i):void 0;const e=t=>({x:r.left+(t.x-p)/(x-p)*(h-r.left-r.right),y:isNaN(t.y)?NaN:u-r.bottom-(t.y-y)/(b-y)*(u-r.top-r.bottom)}),a=e({x:0,y:0}).y,o=(n||[]).map(((t,i)=>({dimensionIndex:i,dimensionLabel:`${i}`,pixelTimes:t.times.map((t=>e({x:t,y:0}).x)),pixelValues:t.values.map((t=>e({x:0,y:t}).y)),type:t.type,attributes:t.attributes})));c(g,{pixelZero:a,dimensions:o});const s=Date.now()-t;await d(s)}a&&await v({canvasContext:g,canvasWidth:h,canvasHeight:u,visibleStartTimeSec:p,visibleEndTimeSec:x,margins:r,annotation:a})}()}),10))}}(),c=(t,n)=>{if(!e)return;const{margins:a,canvasWidth:o,canvasHeight:s}=e;e.zoomInRequired||(t.save(),t.beginPath(),t.rect(a.left,a.top,o-a.left-a.right,s-a.top-a.bottom),t.clip(),n.dimensions.forEach((e=>{var i,n;if("line"===e.type){h(t,e.attributes),t.beginPath();let i=!0;e.pixelTimes.forEach(((n,a)=>{const o=e.pixelValues[a];void 0===o||isNaN(o)?i=!0:(i?t.moveTo(n,o):t.lineTo(n,o),i=!1)})),t.stroke(),t.setLineDash([])}else if("marker"===e.type){u(t,e.attributes);const a=null!==(i=e.attributes.radius)&&void 0!==i?i:2,o=null!==(n=e.attributes.shape)&&void 0!==n?n:"circle";"circle"===o?e.pixelTimes.forEach(((i,n)=>{t.beginPath(),t.ellipse(i,e.pixelValues[n],a,a,0,0,2*Math.PI),t.fill()})):"square"===o&&e.pixelTimes.forEach(((i,n)=>{t.fillRect(i-a,e.pixelValues[n]-a,2*a,2*a)}))}})),(t=>{if(!e)return;if(e.hideLegend)return;if(!i)return;const{legendOpts:n,margins:a,canvasWidth:o}=e,s=i.filter((t=>t.title));if(0===s.length)return;const{location:l}=n,r=20+18*s.length,c="northwest"===l?{x:a.left+20,y:a.top+20,w:200,h:r}:"northeast"===l?{x:o-a.right-200-20,y:a.top+20,w:200,h:r}:void 0;c&&(t.fillStyle="white",t.strokeStyle="gray",t.lineWidth=1.5,t.fillRect(c.x,c.y,c.w,c.h),t.strokeRect(c.x,c.y,c.w,c.h),s.forEach(((e,i)=>{var n;const a=c.y+10+18*i,o={x:c.x+10,y:a,w:50,h:18},s={x:c.x+10+50+10,y:a,w:120,h:18},l=e.title||"untitled";if(t.fillStyle="black",t.font="12px Arial",t.fillText(l,s.x,s.y+s.h/2+6),"line"===e.type)h(t,e.attributes),t.beginPath(),t.moveTo(o.x,o.y+o.h/2),t.lineTo(o.x+o.w,o.y+o.h/2),t.stroke(),t.setLineDash([]);else if("marker"===e.type){u(t,e.attributes);const i=18*.3,a=null!==(n=e.attributes.shape)&&void 0!==n?n:"circle",s={x:o.x+o.w/2,y:o.y+o.h/2};"circle"===a?(t.beginPath(),t.ellipse(s.x,s.y,i,i,0,0,2*Math.PI),t.fill()):"square"===a&&t.fillRect(s.x-i,s.y-i,2*i,2*i)}})))})(t),t.restore())},f=t=>{const i=[];if(!e)return i;const{visibleStartTimeSec:n,visibleEndTimeSec:a}=e;return void 0===n||void 0===a||t.forEach((t=>{const e=t.t,o=t.y,s=e.flatMap(((t,i)=>{const o=Math.min(e.length-1,i+10),s=Math.max(0,i-10),l=e[o],r=e[s];return l>=n&&r<=a?i:[]})),l=s.map((t=>e[t])),r=s.map((t=>o[t]));i.push({type:t.type,times:l,values:r,attributes:t.attributes})})),i},h=(t,e)=>{var i,n;t.strokeStyle=null!==(i=e.color)&&void 0!==i?i:"black",t.lineWidth=null!==(n=e.width)&&void 0!==n?n:1.1,e.dash&&t.setLineDash(e.dash)},u=(t,e)=>{var i;t.fillStyle=null!==(i=e.color)&&void 0!==i?i:"black"};function d(t){return new Promise((e=>{setTimeout(e,t)}))}const m=async t=>{const{canvasContext:e,canvasWidth:i,canvasHeight:n,visibleStartTimeSec:a,visibleEndTimeSec:o,margins:s,spikeTrains:l}=t;for(const t of l){const{unitId:l,spikeTimesSec:r}=t;for(const c of r){if(c<a||c>o)continue;const r=s.left+(c-a)/(o-a)*(i-s.left-s.right),f=s.top,h=n-s.bottom;e.strokeStyle=t.color,e.beginPath(),e.moveTo(r,f),e.lineTo(r,h),e.stroke(),e.fillStyle=t.color;const u=`${l}`;e.font="12px Arial",e.textAlign="center",e.textBaseline="bottom",e.fillText(u,r,f)}}};let p=0;const v=async t=>{p+=1;const e=p,{canvasContext:i,canvasWidth:n,canvasHeight:a,visibleStartTimeSec:o,visibleEndTimeSec:s,margins:l,annotation:r}=t,{events:c,event_types:f}=r,h=c.filter((t=>t.s<=s&&t.e>=o)),u=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255],[255,128,0],[255,0,128],[128,255,0],[0,255,128],[128,0,255],[0,128,255]],d={};for(const t of f){const e=u[t.color_index%u.length];d[t.event_type]=e}let m=Date.now();for(const t of["rect","line"])for(const r of h){if(e!==p)return;const c=d[r.t];if(r.e>r.s){if("rect"!==t)continue;const e={x:l.left+(r.s-o)/(s-o)*(n-l.left-l.right),y:l.top,w:(r.e-r.s)/(s-o)*(n-l.left-l.right),h:a-l.top-l.bottom};i.fillStyle=`rgba(${c[0]},${c[1]},${c[2]},0.3)`,i.fillRect(e.x,e.y,e.w,e.h);const f=Date.now()-m;f>100&&(await v(f),m=Date.now())}else{if("line"!==t)continue;const e={x:l.left+(r.s-o)/(s-o)*(n-l.left-l.right),y:l.top},f={x:e.x,y:a-l.bottom};i.strokeStyle=`rgba(${c[0]},${c[1]},${c[2]},1)`,i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(f.x,f.y),i.stroke()}}function v(t){return new Promise((e=>{setTimeout(e,t)}))}}}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.m=t,i.c=e,i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{i.S={};var t={},e={};i.I=(n,a)=>{a||(a=[]);var o=e[n];if(o||(o=e[n]={}),!(a.indexOf(o)>=0)){if(a.push(o),t[n])return t[n];i.o(i.S,n)||(i.S[n]={}),i.S[n];var s=[];return t[n]=s.length?Promise.all(s).then((()=>t[n]=1)):1}}})(),i(24127)})();