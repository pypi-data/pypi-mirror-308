rules:
  - id: swagger-req-ref
    patterns:
      - pattern: |
          $PATH:
            ...
            $METHOD: 
              ...
              requestBody:
                ...
                content:
                  ...
                  $SOME:
                    ...
                    schema:
                      ...
                      $ref: '$REQREF'
                      ...
      - metavariable-regex:
          metavariable: $METHOD
          regex: (get|post|put|delete)
    message: Req schema ref $PATH $METHOD $REQREF.
    languages:
      - yaml
    severity: WARNING

  - id: swagger-resp-ref
    patterns:
      - pattern-either:
          - pattern: |
              $PATH:
                ...
                $METHOD: 
                  ...
                  responses:
                    ...
                    $CODE:
                      ...
                      content:
                        ...
                        $SOME:
                          ...
                          schema:
                            ...
                            $SOME2:
                              $ref: '$RESPREF'
                            ...
          - pattern: |
              $PATH:
                ...
                $METHOD:
                  ...
                  responses:
                    ...
                    $CODE:
                      ...
                      content:
                        ...
                        $SOME:
                          ...
                          schema:
                            ...
                            $ref: '$RESPREF'
                            ...
      - metavariable-regex:
          metavariable: $METHOD
          regex: (get|post|put|delete)
    message: Resp schema ref $PATH $METHOD $CODE $RESPREF.
    languages:
      - yaml
    severity: WARNING

  - id: swagger-req-param
    patterns:
      - pattern: |
          $PATH:
            ...
            $METHOD: 
              ...
              parameters:
                ...
                - name: $PARAM
                  ...
                  schema:
                    ...
                    type: $TYPE
                    ...
      - metavariable-regex:
          metavariable: $METHOD
          regex: (get|post|put|delete)
    message: Req param $PATH $METHOD $PARAM $TYPE.
    languages:
      - yaml
    severity: WARNING

  - id: swagger-schema
    patterns:
      - pattern-either:
          - pattern: |
              $OBJECT:
                type: object
                ...
                properties:
                  ...
                  $FIELD:
                    ...
                    type: $TYPE
                    ...
          - pattern: |
              $OBJECT:
                type: object
                ...
                properties:
                  ...
                  $FIELD:
                    ...
                    type: $TYPE
                    ...
                    items:
                      $ref: '$REF'
          - pattern: |
              $OBJECT:
                type: object
                ...
                properties:
                  ...
                  $FIELD:
                    ...
                    type: $SOME
                    ...
                    items:
                      ...
                      type: $TYPE
                      ...
          - pattern: |
              $OBJECT:
                type: object
                ...
                properties:
                  ...
                  $FIELD:
                    ...
                    $ref: '$REF'
                    ...
    message: Schema $OBJECT $FIELD $TYPE $REF.
    languages:
      - yaml
    severity: WARNING