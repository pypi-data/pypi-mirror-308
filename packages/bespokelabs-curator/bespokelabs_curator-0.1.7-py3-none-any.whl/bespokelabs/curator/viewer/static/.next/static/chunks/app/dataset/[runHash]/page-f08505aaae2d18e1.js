(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{16194:(e,s,t)=>{Promise.resolve().then(t.bind(t,19638))},19638:(e,s,t)=>{"use strict";t.d(s,{DatasetViewer:()=>A});var a=t(57437),o=t(89669),n=t(50495),r=t(46910),l=t(92694),i=t(35657),d=t(37440),c=t(34446),m=t(3274),u=t(2265);u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...o})}).displayName="Card",u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("flex flex-col space-y-1.5 p-6",t),...o})}).displayName="CardHeader",u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("text-2xl font-semibold leading-none tracking-tight",t),...o})}).displayName="CardTitle",u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...o})}).displayName="CardDescription";let p=u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("p-6 pt-0",t),...o})});p.displayName="CardContent",u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("flex items-center p-6 pt-0",t),...o})}).displayName="CardFooter";var h=t(48484);let f=u.forwardRef((e,s)=>{let{className:t,orientation:o="horizontal",decorative:n=!0,...r}=e;return(0,a.jsx)(h.f,{ref:s,decorative:n,orientation:o,className:(0,d.cn)("shrink-0 bg-border","horizontal"===o?"h-[1px] w-full":"h-full w-[1px]",t),...r})});f.displayName=h.f.displayName;var x=t(6884),g=t(13304),v=t(12218),j=t(74697);let N=g.fC;g.xz,g.x8;let y=g.h_,w=u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)(g.aV,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...o,ref:s})});w.displayName=g.aV.displayName;let b=(0,v.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),k=u.forwardRef((e,s)=>{let{side:t="right",className:o,children:n,...r}=e;return(0,a.jsxs)(y,{children:[(0,a.jsx)(w,{}),(0,a.jsxs)(g.VY,{ref:s,className:(0,d.cn)(b({side:t}),o),...r,children:[(0,a.jsx)(_,{className:"sr-only",children:"Menu"}),n,(0,a.jsxs)(g.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});k.displayName=g.VY.displayName;let _=u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)(g.Dx,{ref:s,className:(0,d.cn)("text-lg font-semibold text-foreground",t),...o})});function C(e){var s,t,o,r,l,i,d,c,m,h,g,v,j;let{item:y,onClose:w}=e,b=(0,u.useCallback)(async e=>{try{await navigator.clipboard.writeText(e),alert("Copied to clipboard!")}catch(e){console.error("Failed to copy:",e),alert("Failed to copy to clipboard")}},[]);return y?(0,a.jsx)(N,{open:!!y,onOpenChange:()=>y&&w(),children:(0,a.jsx)(k,{side:"right",className:"w-full sm:w-[540px] p-0 fixed inset-y-0 border-l",style:{height:"100vh"},children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-6 border-b flex items-center justify-between",children:(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Response Details"})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)(p,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Model"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:y.generic_request.model})]}),(0,a.jsx)(f,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"User Message"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:null===(s=y.generic_request.messages.find(e=>"user"===e.role))||void 0===s?void 0:s.content}),(0,a.jsxs)(n.z,{onClick:()=>{var e;return b((null===(e=y.generic_request.messages.find(e=>"user"===e.role))||void 0===e?void 0:e.content)||"")},variant:"outline",size:"sm",className:"mt-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Copy"]})]}),(0,a.jsx)(f,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Assistant Message"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:"object"==typeof y.response_message?JSON.stringify(y.response_message,null,2):y.response_message}),(0,a.jsxs)(n.z,{onClick:()=>b("object"==typeof y.response_message?JSON.stringify(y.response_message,null,2):y.response_message||""),variant:"outline",size:"sm",className:"mt-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Copy"]})]}),(0,a.jsx)(f,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Token Usage"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Total"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(t=y.raw_response.usage)||void 0===t?void 0:t.total_tokens)||(null===(l=y.raw_response.response)||void 0===l?void 0:null===(r=l.body)||void 0===r?void 0:null===(o=r.usage)||void 0===o?void 0:o.total_tokens)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Prompt"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(i=y.raw_response.usage)||void 0===i?void 0:i.prompt_tokens)||(null===(m=y.raw_response.response)||void 0===m?void 0:null===(c=m.body)||void 0===c?void 0:null===(d=c.usage)||void 0===d?void 0:d.prompt_tokens)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Completion"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(h=y.raw_response.usage)||void 0===h?void 0:h.completion_tokens)||(null===(j=y.raw_response.response)||void 0===j?void 0:null===(v=j.body)||void 0===v?void 0:null===(g=v.usage)||void 0===g?void 0:g.completion_tokens)})]})]})]})]})})]})})}):null}_.displayName=g.Dx.displayName,u.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)(g.dk,{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...o})}).displayName=g.dk.displayName;var S=t(35231),M=t(41672),L=t(2842),T=t(9542),E=t(85475),R=t(13971);let F={total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens"};function z(e){let{data:s,column:t}=e,o=function(e,s){let t=e.map(e=>{var t,a,o,n,r,l,i,d,c,m,u,p;switch(s){case"total_tokens":return(null===(t=e.raw_response.usage)||void 0===t?void 0:t.total_tokens)||(null===(n=e.raw_response.response)||void 0===n?void 0:null===(o=n.body)||void 0===o?void 0:null===(a=o.usage)||void 0===a?void 0:a.total_tokens)||0;case"prompt_tokens":return(null===(r=e.raw_response.usage)||void 0===r?void 0:r.prompt_tokens)||(null===(d=e.raw_response.response)||void 0===d?void 0:null===(i=d.body)||void 0===i?void 0:null===(l=i.usage)||void 0===l?void 0:l.prompt_tokens)||0;case"completion_tokens":return(null===(c=e.raw_response.usage)||void 0===c?void 0:c.completion_tokens)||(null===(p=e.raw_response.response)||void 0===p?void 0:null===(u=p.body)||void 0===u?void 0:null===(m=u.usage)||void 0===m?void 0:m.completion_tokens)||0;default:return 0}}),a=Math.min(...t),o=Math.max(...t);if(a===o)return[{range:"".concat(a),count:t.length}];let{binSize:n,start:r,end:l}=function(e,s){let t=s-e,a=Math.pow(10,Math.floor(Math.log10(t))),o=[.1*a,.2*a,.5*a,a,2*a,5*a,10*a].reduce((e,s)=>Math.abs(t/s-7)<Math.abs(t/e-7)?s:e),n=Math.floor(e/o)*o,r=Math.ceil(s/o)*o;return{binSize:o,start:n,end:r}}(a,o),i=Math.ceil((l-r)/n),d=[];for(let e=0;e<i;e++){let s=r+e*n,t=s+n;d.push({range:"".concat(Math.round(s),"-").concat(Math.round(t)),start:s,count:0})}return t.forEach(e=>{let s=Math.floor((e-r)/n);s>=0&&s<d.length&&d[s].count++}),d.filter(e=>e.count>0).sort((e,s)=>e.start-s.start).map(e=>{let{range:s,count:t}=e;return{range:s,count:t}})}(s,t);if(0===o.length)return null;let n=F[t]||t;return(0,a.jsxs)("div",{className:"w-full h-80",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["Distribution of ",n]}),(0,a.jsx)(S.h,{width:"100%",height:"100%",children:(0,a.jsxs)(M.v,{data:o,margin:{top:10,right:30,left:20,bottom:15},children:[(0,a.jsx)(L.K,{dataKey:"range",fontSize:12,angle:-45,textAnchor:"end",height:70}),(0,a.jsx)(T.B,{}),(0,a.jsx)(E.u,{formatter:e=>["Count: ".concat(e),n]}),(0,a.jsx)(R.$,{dataKey:"count",fill:"#8884d8",name:n})]})})]})}let P=[{key:"user_message",label:"User Message"},{key:"assistant_message",label:"Assistant Message"},{key:"prompt_tokens",label:"Prompt Tokens"},{key:"completion_tokens",label:"Completion Tokens"}];function A(e){let{runHash:s,batchMode:t}=e,[p,h]=(0,u.useState)([]),[f]=(0,u.useState)(null),[x]=(0,u.useState)("asc"),[g]=(0,u.useState)({}),[v,j]=(0,u.useState)("light"),[N,y]=(0,u.useState)(!1),[w,b]=(0,u.useState)("total_tokens"),[k,_]=(0,u.useState)(null),{toast:S}=(0,i.pm)(),[M,L]=(0,u.useState)(!1),[T,E]=(0,u.useState)(0),[R,F]=(0,u.useState)(!0),[A,D]=(0,u.useState)(new Set),[V,O]=(0,u.useState)([]);(0,u.useEffect)(()=>{let e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";j(localStorage.getItem("theme")||e),y(!0)},[]),(0,u.useEffect)(()=>{N&&("dark"===v?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("theme",v))},[v,N]);let U=(0,u.useMemo)(()=>(Array.isArray(p)?p:[]).filter(e=>Object.entries(g).every(s=>{let[t,a]=s;return!a||(0,d.L)(e,t).toLowerCase().includes(a.toLowerCase())})),[p,g]),I=(0,u.useMemo)(()=>f?[...U].sort((e,s)=>{let t=(0,d.L)(e,f),a=(0,d.L)(s,f),o=t.localeCompare(a);return"asc"===x?o:-o}):U,[U,f,x]),K=(0,u.useCallback)(async()=>{if(s)try{let e=new URLSearchParams({batchMode:t.toString(),...t?{processedFiles:V.join(",")}:{lastLine:T.toString()}}),a=await fetch("/api/responses/".concat(s,"?").concat(e));if(!a.ok)throw Error("Failed to fetch responses");let o=await a.json();o.data&&o.data.length>0&&(D(new Set(o.data.map(e=>e.raw_response.id))),h(e=>[...o.data.reverse(),...e]),t?O(e=>[...e,...o.processedFiles]):E(o.totalLines),setTimeout(()=>{D(new Set)},5e3),S({title:"New responses received",description:"".concat(o.data.length," new responses added")}))}catch(e){console.error("Error fetching responses:",e),S({variant:"destructive",title:"Error",description:"Failed to fetch new responses"})}},[s,T,V,t,S]),Z=(0,u.useCallback)(async()=>{if(s)try{let e=new URLSearchParams({batchMode:t.toString(),...t?{processedFiles:""}:{lastLine:"0"}}),a=await fetch("/api/responses/".concat(s,"?").concat(e));if(!a.ok)throw Error("Failed to fetch responses");let{data:o,totalLines:n,processedFiles:r}=await a.json();o&&Array.isArray(o)&&(h(o.reverse()),t&&r?O(r):E(n),S({title:"Dataset loaded",description:"Loaded ".concat(o.length," responses")})),L(!0)}catch(e){console.error("Error reading responses file:",e),S({variant:"destructive",title:"Error",description:"Failed to load dataset"})}finally{F(!1)}},[s,t,S]);return((0,u.useEffect)(()=>{s&&R&&Z()},[s,R,Z]),(0,u.useEffect)(()=>{if(!M||!s||R)return;let e=setInterval(K,5e3);return()=>{clearInterval(e)}},[M,s,K,R]),N)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C,{item:k,onClose:()=>_(null)}),(0,a.jsxs)("div",{className:"min-h-screen bg-background text-foreground overflow-x-hidden",children:[(0,a.jsx)(o.h,{isLoading:R,isPolling:M,onTogglePolling:()=>L(e=>!e),loadingText:"Loading dataset...",pollingText:"Polling for updates..."}),(0,a.jsxs)("main",{className:"container mx-auto p-4 overflow-x-hidden",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-foreground",children:"Dataset Details"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"View and analyze your dataset responses"})]}),(0,a.jsxs)(r.h_,{children:[(0,a.jsx)(r.$F,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"outline",children:w?w.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Select Metric"})}),(0,a.jsxs)(r.AW,{align:"end",children:[(0,a.jsx)(r.Xi,{onClick:()=>b(null),children:"None"}),["total_tokens","prompt_tokens","completion_tokens"].map(e=>(0,a.jsx)(r.Xi,{onClick:()=>b(e),children:"total_tokens"===e?"Total Tokens":"prompt_tokens"===e?"Prompt Tokens":"Completion Tokens"},e))]})]})]}),R?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(m.Z,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading dataset..."})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-8 space-y-4",children:w&&(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4",children:(0,a.jsx)(z,{data:I,column:w})})}),(0,a.jsx)("div",{className:"rounded-lg border bg-card",children:(0,a.jsx)(c.M,{children:(0,a.jsx)(l.d,{columns:P,data:I,getRowKey:e=>e.raw_response.id,getCellContent:(e,s)=>(0,d.L)(e,s),onRowClick:e=>_(e),truncateConfig:{enabled:!0,maxLength:150},pageSize:10,rowProps:e=>({className:(0,d.cn)(A.has(e.raw_response.id)&&"bg-success/30 animate-highlight","transition-colors duration-300"),layout:!0,initial:{opacity:0,y:-20},animate:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-20,transition:{duration:.2}}})})})})]})]})]})]}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[547,602,883,130,215,744],()=>s(16194)),_N_E=e.O()}]);