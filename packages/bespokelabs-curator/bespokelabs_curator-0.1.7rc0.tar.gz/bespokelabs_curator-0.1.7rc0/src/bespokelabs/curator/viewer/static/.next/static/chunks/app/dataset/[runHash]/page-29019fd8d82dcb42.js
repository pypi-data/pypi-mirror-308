(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{16194:(e,t,s)=>{Promise.resolve().then(s.bind(s,19638))},19638:(e,t,s)=>{"use strict";s.d(t,{DatasetViewer:()=>D});var a=s(57437),r=s(2265),o=s(50495),n=s(3274),l=s(37440);r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})}).displayName="Card",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})}).displayName="CardDescription";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...r})});i.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter";var d=s(48484);let c=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:o=!0,...n}=e;return(0,a.jsx)(d.f,{ref:t,decorative:o,orientation:r,className:(0,l.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...n})});c.displayName=d.f.displayName;var m=s(6884),p=s(13304),u=s(12218),f=s(74697);let h=p.fC;p.xz,p.x8;let x=p.h_,g=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(p.aV,{className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});g.displayName=p.aV.displayName;let j=(0,u.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),N=r.forwardRef((e,t)=>{let{side:s="right",className:r,children:o,...n}=e;return(0,a.jsxs)(x,{children:[(0,a.jsx)(g,{}),(0,a.jsxs)(p.VY,{ref:t,className:(0,l.cn)(j({side:s}),r),...n,children:[(0,a.jsx)(y,{className:"sr-only",children:"Menu"}),o,(0,a.jsxs)(p.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});N.displayName=p.VY.displayName;let y=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(p.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold text-foreground",s),...r})});function w(e){var t;let{item:s,onClose:n}=e,l=(0,r.useCallback)(async e=>{try{await navigator.clipboard.writeText(e),alert("Copied to clipboard!")}catch(e){console.error("Failed to copy:",e),alert("Failed to copy to clipboard")}},[]);return s?(0,a.jsx)(h,{open:!!s,onOpenChange:()=>s&&n(),children:(0,a.jsx)(N,{side:"right",className:"w-full sm:w-[540px] p-0 fixed inset-y-0 border-l",style:{height:"100vh"},children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-6 border-b flex items-center justify-between",children:(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Response Details"})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)(i,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Model"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:s.request.model})]}),(0,a.jsx)(c,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"User Message"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:null===(t=s.request.messages.find(e=>"user"===e.role))||void 0===t?void 0:t.content}),(0,a.jsxs)(o.z,{onClick:()=>{var e;return l((null===(e=s.request.messages.find(e=>"user"===e.role))||void 0===e?void 0:e.content)||"")},variant:"outline",size:"sm",className:"mt-2",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Copy"]})]}),(0,a.jsx)(c,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Assistant Message"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:"object"==typeof s.response?JSON.stringify(s.response,null,2):s.response}),(0,a.jsxs)(o.z,{onClick:()=>l("object"==typeof s.response?JSON.stringify(s.response,null,2):s.response||""),variant:"outline",size:"sm",className:"mt-2",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Copy"]})]}),(0,a.jsx)(c,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Token Usage"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Total"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:s.raw_response.usage.total_tokens})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Prompt"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:s.raw_response.usage.prompt_tokens})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Completion"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:s.raw_response.usage.completion_tokens})]})]})]})]})})]})})}):null}y.displayName=p.Dx.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(p.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})}).displayName=p.dk.displayName;var b=s(35231),v=s(41672),k=s(2842),_=s(9542),C=s(85475),S=s(13971);let M={total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens"};function T(e){let{data:t,column:s}=e,r=function(e,t){let s=e.map(e=>{switch(t){case"total_tokens":return e.raw_response.usage.total_tokens;case"prompt_tokens":return e.raw_response.usage.prompt_tokens;case"completion_tokens":return e.raw_response.usage.completion_tokens;default:return 0}}),a=Math.min(...s),r=Math.max(...s);if(a===r)return[{range:"".concat(a),count:s.length}];let{binSize:o,start:n,end:l}=function(e,t){let s=t-e,a=Math.pow(10,Math.floor(Math.log10(s))),r=[.1*a,.2*a,.5*a,a,2*a,5*a,10*a].reduce((e,t)=>Math.abs(s/t-7)<Math.abs(s/e-7)?t:e),o=Math.floor(e/r)*r,n=Math.ceil(t/r)*r;return{binSize:r,start:o,end:n}}(a,r),i=Math.ceil((l-n)/o),d=[];for(let e=0;e<i;e++){let t=n+e*o,s=t+o;d.push({range:"".concat(Math.round(t),"-").concat(Math.round(s)),start:t,count:0})}return s.forEach(e=>{let t=Math.floor((e-n)/o);t>=0&&t<d.length&&d[t].count++}),d.filter(e=>e.count>0).sort((e,t)=>e.start-t.start).map(e=>{let{range:t,count:s}=e;return{range:t,count:s}})}(t,s);if(0===r.length)return null;let o=M[s]||s;return(0,a.jsxs)("div",{className:"w-full h-80",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["Distribution of ",o]}),(0,a.jsx)(b.h,{width:"100%",height:"100%",children:(0,a.jsxs)(v.v,{data:r,margin:{top:10,right:30,left:20,bottom:15},children:[(0,a.jsx)(k.K,{dataKey:"range",fontSize:12,angle:-45,textAnchor:"end",height:70}),(0,a.jsx)(_.B,{}),(0,a.jsx)(C.u,{formatter:e=>["Count: ".concat(e),o]}),(0,a.jsx)(S.$,{dataKey:"count",fill:"#8884d8",name:o})]})})]})}var E=s(46910),A=s(92694),R=s(35657),z=s(34446),L=s(89669);let F=[{key:"user_message",label:"User Message"},{key:"assistant_message",label:"Assistant Message"},{key:"prompt_tokens",label:"Prompt Tokens"},{key:"completion_tokens",label:"Completion Tokens"}];function D(e){let{runHash:t}=e,[s,i]=(0,r.useState)([]),[d]=(0,r.useState)(null),[c]=(0,r.useState)("asc"),[m]=(0,r.useState)({}),[p,u]=(0,r.useState)("light"),[f,h]=(0,r.useState)(!1),[x,g]=(0,r.useState)("total_tokens"),[j,N]=(0,r.useState)(null),{toast:y}=(0,R.pm)(),[b,v]=(0,r.useState)(!1),[k,_]=(0,r.useState)(0),[C,S]=(0,r.useState)(!0),[M,D]=(0,r.useState)(new Set);(0,r.useEffect)(()=>{let e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";u(localStorage.getItem("theme")||e),h(!0)},[]),(0,r.useEffect)(()=>{f&&("dark"===p?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("theme",p))},[p,f]);let P=(0,r.useMemo)(()=>(Array.isArray(s)?s:[]).filter(e=>Object.entries(m).every(t=>{let[s,a]=t;return!a||(0,l.L)(e,s).toLowerCase().includes(a.toLowerCase())})),[s,m]),O=(0,r.useMemo)(()=>d?[...P].sort((e,t)=>{let s=(0,l.L)(e,d),a=(0,l.L)(t,d),r=s.localeCompare(a);return"asc"===c?r:-r}):P,[P,d,c]),V=(0,r.useCallback)(async()=>{if(t)try{let e=await fetch("/api/responses/".concat(t,"?lastLine=").concat(k));if(!e.ok)throw Error("Failed to fetch responses");let{data:s,totalLines:a}=await e.json();s&&s.length>0&&(D(new Set(s.map(e=>e.raw_response.id))),i(e=>[...s.reverse(),...e]),_(a),setTimeout(()=>{D(new Set)},5e3),y({title:"New responses received",description:"".concat(s.length," new responses added")}))}catch(e){console.error("Error fetching responses:",e),y({variant:"destructive",title:"Error",description:"Failed to fetch new responses"})}},[t,k,y]),q=(0,r.useCallback)(async()=>{if(t)try{let e=await fetch("/api/responses/".concat(t));if(!e.ok)throw Error("Failed to fetch responses");let{data:s,totalLines:a}=await e.json();s&&Array.isArray(s)&&(i(s.reverse()),_(a),y({title:"Dataset loaded",description:"Loaded ".concat(s.length," responses")})),v(!0)}catch(e){console.error("Error reading responses file:",e),y({variant:"destructive",title:"Error",description:"Failed to load dataset"})}finally{S(!1)}},[t,y]);return((0,r.useEffect)(()=>{t&&C&&q()},[t,C,q]),(0,r.useEffect)(()=>{if(!b||!t||C)return;let e=setInterval(V,5e3);return()=>{clearInterval(e)}},[b,t,V,C]),f)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w,{item:j,onClose:()=>N(null)}),(0,a.jsxs)("div",{className:"min-h-screen bg-background text-foreground overflow-x-hidden",children:[(0,a.jsx)(L.h,{isLoading:C,isPolling:b,onTogglePolling:()=>v(e=>!e),loadingText:"Loading dataset...",pollingText:"Polling for updates..."}),(0,a.jsxs)("main",{className:"container mx-auto p-4 overflow-x-hidden",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-foreground",children:"Dataset Details"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"View and analyze your dataset responses"})]}),(0,a.jsxs)(E.h_,{children:[(0,a.jsx)(E.$F,{asChild:!0,children:(0,a.jsx)(o.z,{variant:"outline",children:x?x.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Select Metric"})}),(0,a.jsxs)(E.AW,{align:"end",children:[(0,a.jsx)(E.Xi,{onClick:()=>g(null),children:"None"}),["total_tokens","prompt_tokens","completion_tokens"].map(e=>(0,a.jsx)(E.Xi,{onClick:()=>g(e),children:"total_tokens"===e?"Total Tokens":"prompt_tokens"===e?"Prompt Tokens":"Completion Tokens"},e))]})]})]}),C?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(n.Z,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading dataset..."})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-8 space-y-4",children:x&&(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4",children:(0,a.jsx)(T,{data:O,column:x})})}),(0,a.jsx)("div",{className:"rounded-lg border bg-card",children:(0,a.jsx)(z.M,{children:(0,a.jsx)(A.d,{columns:F,data:O,getRowKey:e=>e.raw_response.id,getCellContent:(e,t)=>{var s,a,r;switch(t){case"user_message":return(null===(s=e.request.messages.find(e=>"user"===e.role))||void 0===s?void 0:s.content)||"N/A";case"assistant_message":if("object"==typeof e.response)return JSON.stringify(e.response,null,2);return e.response||"N/A";case"prompt_tokens":return(null===(a=e.raw_response.usage.prompt_tokens)||void 0===a?void 0:a.toString())||"N/A";case"completion_tokens":return(null===(r=e.raw_response.usage.completion_tokens)||void 0===r?void 0:r.toString())||"N/A";default:return"N/A"}},onRowClick:e=>N(e),truncateConfig:{enabled:!0,maxLength:150},pageSize:10,rowProps:e=>({className:(0,l.cn)(M.has(e.raw_response.id)&&"bg-success/30 animate-highlight","transition-colors duration-300"),layout:!0,initial:{opacity:0,y:-20},animate:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-20,transition:{duration:.2}}})})})})]})]})]})]}):null}}},e=>{var t=t=>e(e.s=t);e.O(0,[547,602,883,130,215,744],()=>t(16194)),_N_E=e.O()}]);