# find_reported_transmissions

This file will generate a file called `FOUND_TRANSMISSIONS.json` which a mapping {filename: [schedule_id1, schedule_id2, ...]} containing all schedule IDS that
were in each of the reports for a specific batch.


### Env Variables
```
BAZAAR_MONGO_URI=
BAZAAR_STORAGE_URI=
MONGO_URI=
NAMESPACE=
```


# cleanup_reported

This takes two files in the format generated by `find_reported_transmissions`:
- It will take all schedules in the first one and **UNSET** their `reported` flag.
- It will then take all schedules in the second one and **MARK** them as `reported`. It will also mark all parallel transmissions in regional channels as
reported (according to YLE rules).

The intention is removing the last batch and fix the issues the previous one had when setting the right reported flag.
After this, we can regenerate the last batch (hopefully) without incidents.

So, for example, I ran it providing the 2023-11-01 file as the first argument and the 2023-10-20 as the second.
This took all transmissions included in the 2023-11-01 batch and set them as `reported=False`, while setting `reported=True` for the batch in 2023-10-20.
The final result is the DB will be in the right status after the `2023-10-20` batch and ready to correctly report the `2023-11-01` batch including **ONLY**
the actual unreported transmissions.

### Env Variables
```
MONGO_URI=
FILE_TO_CLEAN=
FILE_TO_KEEP=
```


# trigger_reports

This last file will actually trigger the report generation. It will send the appropriate Celery tasks to YLE's `reports-processor`.
You usually shouldn't need to modify more than the `END_TIME` variable which should match the batch you want to generate. For example, to re-generate the batch
which should go out on the `2023-11-01`, you will have to set `END_TIME="2023-11-01T00:30:47"`.

The specific hours:minutes:seconds depend on each batch, you can find yours in the filenames in `https://av-download.bmat.com/`. You can ask CRMs for
credentials.

### Env Variables
```
MONGO_URI=
CELERY=
```

**Note**: This file uses a different requirements file: `requirements-trigger-reports.txt`. Be sure to install that!
